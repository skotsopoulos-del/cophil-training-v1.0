<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-16">

<title>Session 3: Hands-on Python for Geospatial Data – CoPhil EO AI/ML Training</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../day1/sessions/session4.html" rel="next">
<link href="../../day1/sessions/session2.html" rel="prev">
<link href="../../images/favicon.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-c9822816d3895e59fda95a6fa7545fef.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-3775014fae9fc394bbda1d6ff89dd45e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-509191933"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-509191933', { 'anonymize_ip': true});
</script>
<style>html{ scroll-behavior: smooth; }</style>
<meta name="mermaid-theme" content="default">
<script src="../../site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="../../site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="../../site_libs/quarto-diagram/mermaid.css" rel="stylesheet">


<link rel="stylesheet" href="../../styles/custom.css">
<link rel="stylesheet" href="../../styles/phase2-enhancements.css">
</head>

<body class="nav-sidebar floating nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">CoPhil EO AI/ML Training</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-training-days" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Training Days</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-training-days">    
        <li>
    <a class="dropdown-item" href="../../day1/index.html">
 <span class="dropdown-text">Day 1: EO Data &amp; Fundamentals</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day2/index.html">
 <span class="dropdown-text">Day 2: Machine Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day3/index.html">
 <span class="dropdown-text">Day 3: Deep Learning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../day4/index.html">
 <span class="dropdown-text">Day 4: Advanced Topics</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../../resources/setup.html">
 <span class="dropdown-text">Setup Guide</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/philippine-eo.html">
 <span class="dropdown-text">Philippine EO Links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/cheatsheets.html">
 <span class="dropdown-text">Cheat Sheets</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/faq.html">
 <span class="dropdown-text">FAQ</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../resources/glossary.html">
 <span class="dropdown-text">Glossary</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../resources/downloads.html"> <i class="bi bi-download" role="img">
</i> 
<span class="menu-text">Materials</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../day1/sessions/session1.html">Sessions</a></li><li class="breadcrumb-item"><a href="../../day1/sessions/session3.html">Session 3: Hands-on Python for Geospatial Data</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../../index.html" class="sidebar-logo-link">
      </a>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1: EO Data &amp; AI/ML Fundamentals</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Sessions</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 1: Copernicus Sentinel Data Deep Dive &amp; Philippine EO Ecosystem</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 2: Core Concepts of AI/ML for Earth Observation</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session3.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Session 3: Hands-on Python for Geospatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/sessions/session4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Session 4: Introduction to Google Earth Engine</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false">
 <span class="menu-text">Notebooks</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/notebook1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook 1: Python for Geospatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/notebook2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Notebook 2: Google Earth Engine</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/Day1_Session3_Python_Geospatial_Data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1, Session 3: Python for Geospatial Data</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../day1/notebooks/Day1_Session4_Google_Earth_Engine.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Day 1, Session 4: Google Earth Engine Python API</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="2">
    <h2 id="toc-title">On This Page</h2>
   
  <ul>
  <li><a href="#session-overview" id="toc-session-overview" class="nav-link active" data-scroll-target="#session-overview">Session Overview</a>
  <ul class="collapse">
  <li><a href="#learning-objectives" id="toc-learning-objectives" class="nav-link" data-scroll-target="#learning-objectives">Learning Objectives</a></li>
  </ul></li>
  <li><a href="#presentation-slides" id="toc-presentation-slides" class="nav-link" data-scroll-target="#presentation-slides">Presentation Slides</a></li>
  <li><a href="#part-1-why-python-for-earth-observation" id="toc-part-1-why-python-for-earth-observation" class="nav-link" data-scroll-target="#part-1-why-python-for-earth-observation">Part 1: Why Python for Earth Observation?</a>
  <ul class="collapse">
  <li><a href="#the-python-eo-ecosystem" id="toc-the-python-eo-ecosystem" class="nav-link" data-scroll-target="#the-python-eo-ecosystem">The Python EO Ecosystem</a></li>
  <li><a href="#python-in-philippine-eo-systems" id="toc-python-in-philippine-eo-systems" class="nav-link" data-scroll-target="#python-in-philippine-eo-systems">Python in Philippine EO Systems</a></li>
  <li><a href="#connecting-to-session-2-preprocessing-for-ml" id="toc-connecting-to-session-2-preprocessing-for-ml" class="nav-link" data-scroll-target="#connecting-to-session-2-preprocessing-for-ml">Connecting to Session 2: Preprocessing for ML</a></li>
  </ul></li>
  <li><a href="#part-2-setting-up-google-colaboratory" id="toc-part-2-setting-up-google-colaboratory" class="nav-link" data-scroll-target="#part-2-setting-up-google-colaboratory">Part 2: Setting Up Google Colaboratory</a>
  <ul class="collapse">
  <li><a href="#what-is-google-colab" id="toc-what-is-google-colab" class="nav-link" data-scroll-target="#what-is-google-colab">What is Google Colab?</a></li>
  <li><a href="#creating-your-first-colab-notebook" id="toc-creating-your-first-colab-notebook" class="nav-link" data-scroll-target="#creating-your-first-colab-notebook">Creating Your First Colab Notebook</a></li>
  <li><a href="#understanding-the-colab-interface" id="toc-understanding-the-colab-interface" class="nav-link" data-scroll-target="#understanding-the-colab-interface">Understanding the Colab Interface</a></li>
  <li><a href="#connecting-google-drive" id="toc-connecting-google-drive" class="nav-link" data-scroll-target="#connecting-google-drive">Connecting Google Drive</a></li>
  <li><a href="#understanding-colab-runtime" id="toc-understanding-colab-runtime" class="nav-link" data-scroll-target="#understanding-colab-runtime">Understanding Colab Runtime</a></li>
  </ul></li>
  <li><a href="#part-3-installing-geospatial-libraries" id="toc-part-3-installing-geospatial-libraries" class="nav-link" data-scroll-target="#part-3-installing-geospatial-libraries">Part 3: Installing Geospatial Libraries</a>
  <ul class="collapse">
  <li><a href="#required-libraries" id="toc-required-libraries" class="nav-link" data-scroll-target="#required-libraries">Required Libraries</a></li>
  <li><a href="#installation" id="toc-installation" class="nav-link" data-scroll-target="#installation">Installation</a></li>
  <li><a href="#verify-installation" id="toc-verify-installation" class="nav-link" data-scroll-target="#verify-installation">Verify Installation</a></li>
  </ul></li>
  <li><a href="#part-4-python-basics-refresher" id="toc-part-4-python-basics-refresher" class="nav-link" data-scroll-target="#part-4-python-basics-refresher">Part 4: Python Basics Refresher</a>
  <ul class="collapse">
  <li><a href="#data-types" id="toc-data-types" class="nav-link" data-scroll-target="#data-types">Data Types</a></li>
  <li><a href="#control-structures" id="toc-control-structures" class="nav-link" data-scroll-target="#control-structures">Control Structures</a></li>
  <li><a href="#functions" id="toc-functions" class="nav-link" data-scroll-target="#functions">Functions</a></li>
  </ul></li>
  <li><a href="#part-5-vector-data-with-geopandas" id="toc-part-5-vector-data-with-geopandas" class="nav-link" data-scroll-target="#part-5-vector-data-with-geopandas">Part 5: Vector Data with GeoPandas</a>
  <ul class="collapse">
  <li><a href="#what-is-vector-data" id="toc-what-is-vector-data" class="nav-link" data-scroll-target="#what-is-vector-data">What is Vector Data?</a></li>
  <li><a href="#understanding-coordinate-reference-systems-crs" id="toc-understanding-coordinate-reference-systems-crs" class="nav-link" data-scroll-target="#understanding-coordinate-reference-systems-crs">Understanding Coordinate Reference Systems (CRS)</a></li>
  <li><a href="#loading-philippine-administrative-boundaries" id="toc-loading-philippine-administrative-boundaries" class="nav-link" data-scroll-target="#loading-philippine-administrative-boundaries">Loading Philippine Administrative Boundaries</a></li>
  <li><a href="#philippine-geospatial-data-sources" id="toc-philippine-geospatial-data-sources" class="nav-link" data-scroll-target="#philippine-geospatial-data-sources">Philippine Geospatial Data Sources</a></li>
  <li><a href="#inspecting-a-geodataframe" id="toc-inspecting-a-geodataframe" class="nav-link" data-scroll-target="#inspecting-a-geodataframe">Inspecting a GeoDataFrame</a></li>
  <li><a href="#working-with-coordinate-reference-systems" id="toc-working-with-coordinate-reference-systems" class="nav-link" data-scroll-target="#working-with-coordinate-reference-systems">Working with Coordinate Reference Systems</a></li>
  <li><a href="#calculating-geometric-properties" id="toc-calculating-geometric-properties" class="nav-link" data-scroll-target="#calculating-geometric-properties">Calculating Geometric Properties</a></li>
  <li><a href="#filtering-and-querying" id="toc-filtering-and-querying" class="nav-link" data-scroll-target="#filtering-and-querying">Filtering and Querying</a></li>
  <li><a href="#spatial-operations" id="toc-spatial-operations" class="nav-link" data-scroll-target="#spatial-operations">Spatial Operations</a></li>
  <li><a href="#visualizing-vector-data" id="toc-visualizing-vector-data" class="nav-link" data-scroll-target="#visualizing-vector-data">Visualizing Vector Data</a></li>
  <li><a href="#creating-area-of-interest-aoi-geometries" id="toc-creating-area-of-interest-aoi-geometries" class="nav-link" data-scroll-target="#creating-area-of-interest-aoi-geometries">Creating Area of Interest (AOI) Geometries</a></li>
  </ul></li>
  <li><a href="#part-6-raster-data-with-rasterio" id="toc-part-6-raster-data-with-rasterio" class="nav-link" data-scroll-target="#part-6-raster-data-with-rasterio">Part 6: Raster Data with Rasterio</a>
  <ul class="collapse">
  <li><a href="#what-is-raster-data" id="toc-what-is-raster-data" class="nav-link" data-scroll-target="#what-is-raster-data">What is Raster Data?</a></li>
  <li><a href="#understanding-sentinel-2-bands-and-resolution" id="toc-understanding-sentinel-2-bands-and-resolution" class="nav-link" data-scroll-target="#understanding-sentinel-2-bands-and-resolution">Understanding Sentinel-2 Bands and Resolution</a></li>
  <li><a href="#opening-a-raster-file" id="toc-opening-a-raster-file" class="nav-link" data-scroll-target="#opening-a-raster-file">Opening a Raster File</a></li>
  <li><a href="#reading-raster-data-into-arrays" id="toc-reading-raster-data-into-arrays" class="nav-link" data-scroll-target="#reading-raster-data-into-arrays">Reading Raster Data into Arrays</a></li>
  <li><a href="#calculating-spectral-indices" id="toc-calculating-spectral-indices" class="nav-link" data-scroll-target="#calculating-spectral-indices">Calculating Spectral Indices</a></li>
  <li><a href="#philippine-application-rice-paddy-monitoring" id="toc-philippine-application-rice-paddy-monitoring" class="nav-link" data-scroll-target="#philippine-application-rice-paddy-monitoring">Philippine Application: Rice Paddy Monitoring</a></li>
  <li><a href="#creating-rgb-and-false-color-composites" id="toc-creating-rgb-and-false-color-composites" class="nav-link" data-scroll-target="#creating-rgb-and-false-color-composites">Creating RGB and False Color Composites</a></li>
  <li><a href="#saving-processed-rasters" id="toc-saving-processed-rasters" class="nav-link" data-scroll-target="#saving-processed-rasters">Saving Processed Rasters</a></li>
  </ul></li>
  <li><a href="#part-7-combining-vector-and-raster-operations" id="toc-part-7-combining-vector-and-raster-operations" class="nav-link" data-scroll-target="#part-7-combining-vector-and-raster-operations">Part 7: Combining Vector and Raster Operations</a>
  <ul class="collapse">
  <li><a href="#clipping-raster-to-vector-boundary" id="toc-clipping-raster-to-vector-boundary" class="nav-link" data-scroll-target="#clipping-raster-to-vector-boundary">Clipping Raster to Vector Boundary</a></li>
  <li><a href="#sampling-raster-values-at-point-locations" id="toc-sampling-raster-values-at-point-locations" class="nav-link" data-scroll-target="#sampling-raster-values-at-point-locations">Sampling Raster Values at Point Locations</a></li>
  <li><a href="#zonal-statistics" id="toc-zonal-statistics" class="nav-link" data-scroll-target="#zonal-statistics">Zonal Statistics</a></li>
  </ul></li>
  <li><a href="#part-8-preprocessing-workflows-for-machine-learning" id="toc-part-8-preprocessing-workflows-for-machine-learning" class="nav-link" data-scroll-target="#part-8-preprocessing-workflows-for-machine-learning">Part 8: Preprocessing Workflows for Machine Learning</a>
  <ul class="collapse">
  <li><a href="#workflow-1-preparing-training-samples-for-classification" id="toc-workflow-1-preparing-training-samples-for-classification" class="nav-link" data-scroll-target="#workflow-1-preparing-training-samples-for-classification">Workflow 1: Preparing Training Samples for Classification</a></li>
  <li><a href="#workflow-2-creating-multi-temporal-stack" id="toc-workflow-2-creating-multi-temporal-stack" class="nav-link" data-scroll-target="#workflow-2-creating-multi-temporal-stack">Workflow 2: Creating Multi-Temporal Stack</a></li>
  <li><a href="#workflow-3-resampling-and-reprojection" id="toc-workflow-3-resampling-and-reprojection" class="nav-link" data-scroll-target="#workflow-3-resampling-and-reprojection">Workflow 3: Resampling and Reprojection</a></li>
  <li><a href="#workflow-4-data-augmentation-for-deep-learning" id="toc-workflow-4-data-augmentation-for-deep-learning" class="nav-link" data-scroll-target="#workflow-4-data-augmentation-for-deep-learning">Workflow 4: Data Augmentation for Deep Learning</a></li>
  </ul></li>
  <li><a href="#part-9-best-practices-and-common-pitfalls" id="toc-part-9-best-practices-and-common-pitfalls" class="nav-link" data-scroll-target="#part-9-best-practices-and-common-pitfalls">Part 9: Best Practices and Common Pitfalls</a>
  <ul class="collapse">
  <li><a href="#memory-management-for-large-rasters" id="toc-memory-management-for-large-rasters" class="nav-link" data-scroll-target="#memory-management-for-large-rasters">Memory Management for Large Rasters</a></li>
  <li><a href="#vectorization-vs.-loops" id="toc-vectorization-vs.-loops" class="nav-link" data-scroll-target="#vectorization-vs.-loops">Vectorization vs.&nbsp;Loops</a></li>
  <li><a href="#error-handling-for-geospatial-operations" id="toc-error-handling-for-geospatial-operations" class="nav-link" data-scroll-target="#error-handling-for-geospatial-operations">Error Handling for Geospatial Operations</a></li>
  <li><a href="#troubleshooting-common-issues" id="toc-troubleshooting-common-issues" class="nav-link" data-scroll-target="#troubleshooting-common-issues">Troubleshooting Common Issues</a></li>
  <li><a href="#code-organization-for-reproducibility" id="toc-code-organization-for-reproducibility" class="nav-link" data-scroll-target="#code-organization-for-reproducibility">Code Organization for Reproducibility</a></li>
  </ul></li>
  <li><a href="#part-10-complete-workflow-example" id="toc-part-10-complete-workflow-example" class="nav-link" data-scroll-target="#part-10-complete-workflow-example">Part 10: Complete Workflow Example</a>
  <ul class="collapse">
  <li><a href="#scenario-agricultural-monitoring-for-palawan-rice-area" id="toc-scenario-agricultural-monitoring-for-palawan-rice-area" class="nav-link" data-scroll-target="#scenario-agricultural-monitoring-for-palawan-rice-area">Scenario: Agricultural Monitoring for Palawan Rice Area</a></li>
  </ul></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#practice-exercises" id="toc-practice-exercises" class="nav-link" data-scroll-target="#practice-exercises">Practice Exercises</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further Reading</a>
  <ul class="collapse">
  <li><a href="#geopandas" id="toc-geopandas" class="nav-link" data-scroll-target="#geopandas">GeoPandas</a></li>
  <li><a href="#rasterio" id="toc-rasterio" class="nav-link" data-scroll-target="#rasterio">Rasterio</a></li>
  <li><a href="#combined-workflows" id="toc-combined-workflows" class="nav-link" data-scroll-target="#combined-workflows">Combined Workflows</a></li>
  <li><a href="#philippine-context" id="toc-philippine-context" class="nav-link" data-scroll-target="#philippine-context">Philippine Context</a></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics">Advanced Topics</a></li>
  </ul></li>
  <li><a href="#jupyter-notebook" id="toc-jupyter-notebook" class="nav-link" data-scroll-target="#jupyter-notebook">Jupyter Notebook</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../day1/sessions/session1.html">Sessions</a></li><li class="breadcrumb-item"><a href="../../day1/sessions/session3.html">Session 3: Hands-on Python for Geospatial Data</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">Session 3: Hands-on Python for Geospatial Data</h1>
<p class="subtitle lead">Master vector and raster data processing with GeoPandas and Rasterio</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Date</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 16, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<nav class="breadcrumb" aria-label="Breadcrumb">
<a href="../../index.html">Home</a> <span class="breadcrumb-separator" aria-hidden="true">›</span> <a href="../index.html">Day 1</a> <span class="breadcrumb-separator" aria-hidden="true">›</span> <span class="breadcrumb-current">Session 3</span>
</nav>
<div class="session-info">
<p><strong>Duration:</strong> 2 hours | <strong>Format:</strong> Hands-on Coding | <strong>Platform:</strong> Google Colaboratory</p>
</div>
<section id="session-overview" class="level2">
<h2 class="anchored" data-anchor-id="session-overview">Session Overview</h2>
<p>This hands-on session teaches you how to work with geospatial data in Python - the foundation of Earth Observation workflows. Python has become the dominant language for EO and ML applications due to its rich ecosystem of libraries, active community, and seamless integration with operational systems. You’ll use Google Colab (no installation needed!), learn vector data operations with GeoPandas, and master raster processing with Rasterio. By the end, you’ll understand why Python powers Philippine EO platforms like DATOS, SkAI-Pinas, and PRiSM, and you’ll be able to prepare satellite data for AI/ML workflows.</p>
<hr>
<section id="learning-objectives" class="level3 learning-objectives">
<h3 class="anchored" data-anchor-id="learning-objectives">Learning Objectives</h3>
<p>By the end of this session, you will be able to:</p>
<ul>
<li><strong>Explain</strong> why Python is the dominant language for EO and ML applications</li>
<li><strong>Set up</strong> Google Colaboratory for geospatial analysis</li>
<li><strong>Mount</strong> Google Drive for data access and storage</li>
<li><strong>Install</strong> Python geospatial libraries (GeoPandas, Rasterio)</li>
<li><strong>Read and inspect</strong> vector data (shapefiles, GeoJSON) with GeoPandas</li>
<li><strong>Transform</strong> coordinate reference systems for Philippine UTM zones</li>
<li><strong>Query and filter</strong> geospatial DataFrames spatially and by attributes</li>
<li><strong>Visualize</strong> vector data with static and interactive maps</li>
<li><strong>Open and examine</strong> raster files and their metadata with Rasterio</li>
<li><strong>Read</strong> raster bands into NumPy arrays efficiently</li>
<li><strong>Calculate</strong> spectral indices (NDVI, EVI, NDWI) from Sentinel-2 bands</li>
<li><strong>Create</strong> RGB and false-color composites from multispectral imagery</li>
<li><strong>Clip</strong> rasters to vector boundaries for area-of-interest analysis</li>
<li><strong>Sample</strong> raster values at point locations for validation</li>
<li><strong>Apply</strong> preprocessing workflows for ML-ready data</li>
<li><strong>Combine</strong> vector and raster operations for complete EO workflows</li>
</ul>
</section>
<hr>
</section>
<section id="presentation-slides" class="level2">
<h2 class="anchored" data-anchor-id="presentation-slides">Presentation Slides</h2>
<iframe src="../presentations/03_session3_python_geospatial.html" width="100%" height="600" style="border: 1px solid #ccc; border-radius: 4px;">
</iframe>
<hr>
</section>
<section id="part-1-why-python-for-earth-observation" class="level2">
<h2 class="anchored" data-anchor-id="part-1-why-python-for-earth-observation">Part 1: Why Python for Earth Observation?</h2>
<section id="the-python-eo-ecosystem" class="level3">
<h3 class="anchored" data-anchor-id="the-python-eo-ecosystem">The Python EO Ecosystem</h3>
<p>Python has become the <strong>de facto standard</strong> for Earth Observation and Machine Learning. Understanding why helps you leverage the right tools for your projects.</p>
<section id="key-advantages" class="level4">
<h4 class="anchored" data-anchor-id="key-advantages">Key Advantages</h4>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TB
    subgraph DataAccess["DATA ACCESS"]
        DA1[Earth Engine&lt;br/&gt;Python API]
        DA2[Sentinel Hub&lt;br/&gt;sentinelhub-py]
        DA3[NASA CMR&lt;br/&gt;earthaccess]
        DA4[STAC&lt;br/&gt;pystac-client]
    end

    subgraph Geospatial["GEOSPATIAL PROCESSING"]
        GP1[GeoPandas&lt;br/&gt;Vector data]
        GP2[Rasterio&lt;br/&gt;Raster I/O]
        GP3[Xarray&lt;br/&gt;N-D arrays]
        GP4[Rioxarray&lt;br/&gt;Raster+Xarray]
        GP5[GDAL/OGR&lt;br/&gt;Low-level ops]
    end

    subgraph DataScience["DATA SCIENCE"]
        DS1[NumPy&lt;br/&gt;Array operations]
        DS2[Pandas&lt;br/&gt;Tabular data]
        DS3[SciPy&lt;br/&gt;Scientific computing]
        DS4[Dask&lt;br/&gt;Parallel computing]
    end

    subgraph ML["MACHINE LEARNING"]
        ML1[Scikit-learn&lt;br/&gt;Traditional ML]
        ML2[TensorFlow&lt;br/&gt;Deep Learning]
        ML3[PyTorch&lt;br/&gt;Deep Learning]
        ML4[TorchGeo&lt;br/&gt;Geospatial DL]
    end

    subgraph Viz["VISUALIZATION"]
        VZ1[Matplotlib&lt;br/&gt;Static plots]
        VZ2[Folium&lt;br/&gt;Interactive maps]
        VZ3[Plotly&lt;br/&gt;Interactive viz]
        VZ4[Cartopy&lt;br/&gt;Map projections]
    end

    DataAccess --&gt; Geospatial
    Geospatial --&gt; DataScience
    DataScience --&gt; ML
    Geospatial --&gt; Viz
    ML --&gt; Viz

    style DataAccess fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style Geospatial fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style DataScience fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style ML fill:#ffe6e6,stroke:#cc0044,stroke-width:2px
    style Viz fill:#f0e6ff,stroke:#6666cc,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Python Earth Observation Ecosystem</figcaption> </figure><p></p>
</div>
</div>
</div>
<p><strong>1. Rich Library Ecosystem</strong> - <strong>Geospatial Processing:</strong> GeoPandas, Rasterio, Xarray, Rioxarray, GDAL bindings - <strong>Data Science:</strong> NumPy, Pandas, SciPy for array operations and analysis - <strong>Machine Learning:</strong> Scikit-learn, TensorFlow, PyTorch, TorchGeo - <strong>Visualization:</strong> Matplotlib, Seaborn, Folium, Plotly for static and interactive maps</p>
<p><strong>2. Seamless Integration</strong> - <strong>Cloud Platforms:</strong> Google Earth Engine Python API, AWS, Azure - <strong>Big Data:</strong> Dask for parallel/distributed computing on large rasters - <strong>Workflows:</strong> Easy integration between data access → preprocessing → ML → visualization</p>
<p><strong>3. Active Community</strong> - Extensive documentation and tutorials - Stack Overflow, GitHub discussions, forums - Open-source contributions and rapid bug fixes - Jupyter notebooks for reproducible research</p>
<p><strong>4. Industry and Research Standard</strong> - NASA, ESA, USGS use Python for operational systems - Scientific papers increasingly publish Python code - Enterprise solutions (Planet Labs, Descartes Labs) built on Python</p>
</section>
</section>
<section id="python-in-philippine-eo-systems" class="level3 philippine-context">
<h3 class="anchored" data-anchor-id="python-in-philippine-eo-systems">Python in Philippine EO Systems</h3>
<p><strong>DATOS (DOST-ASTI)</strong> - Python backend for automated processing - Integrates Sentinel data access and analysis - Generates data products for government use</p>
<p><strong>PRiSM (PhilRice/IRRI)</strong> - Python workflows for SAR-based rice monitoring - Combines Sentinel-1, field data, and crop models - Operational since 2014</p>
<p><strong>SkAI-Pinas (PhilSA)</strong> - Python-based AI/ML training platform - Pre-configured with GeoPandas, Rasterio, TensorFlow - Jupyter notebooks for capacity building</p>
<p><strong>ALaM Project (DOST)</strong> - Python for agricultural land monitoring - Automated crop classification pipelines - Integration with local government data systems</p>
<p><strong>Key Takeaway:</strong> Learning Python for EO opens doors to operational systems, not just research.</p>
</section>
<section id="connecting-to-session-2-preprocessing-for-ml" class="level3">
<h3 class="anchored" data-anchor-id="connecting-to-session-2-preprocessing-for-ml">Connecting to Session 2: Preprocessing for ML</h3>
<p>In <strong>Session 2</strong>, you learned that data preprocessing is critical for ML success:</p>
<ul>
<li><strong>Atmospheric correction:</strong> Sen2Cor converts Sentinel-2 Level-1C → Level-2A</li>
<li><strong>Normalization:</strong> Scaling pixel values for neural networks</li>
<li><strong>Cloud masking:</strong> Removing contaminated observations</li>
<li><strong>Data augmentation:</strong> Rotation, flipping, cropping</li>
</ul>
<p><strong>This session provides the Python skills to implement these preprocessing steps</strong> for your own projects. By the end, you’ll prepare analysis-ready data for the ML models in Sessions 5-7.</p>
<hr>
</section>
</section>
<section id="part-2-setting-up-google-colaboratory" class="level2">
<h2 class="anchored" data-anchor-id="part-2-setting-up-google-colaboratory">Part 2: Setting Up Google Colaboratory</h2>
<section id="what-is-google-colab" class="level3">
<h3 class="anchored" data-anchor-id="what-is-google-colab">What is Google Colab?</h3>
<p><strong>Google Colaboratory (Colab)</strong> is a free cloud-based Jupyter notebook environment that allows you to:</p>
<ul>
<li>Write and execute Python code in your browser</li>
<li>Access free GPU/TPU for machine learning</li>
<li>Collaborate with others in real-time</li>
<li>Save notebooks to Google Drive</li>
<li>No local installation required!</li>
</ul>
<p><strong>Perfect for this training:</strong> Everyone has the same environment, no dependency issues, accessible from anywhere.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Why Colab for Philippine Trainees?
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>No hardware requirements:</strong> Works on any laptop/computer with a browser</li>
<li><strong>Internet connectivity:</strong> Even with limited bandwidth, code runs on Google’s servers</li>
<li><strong>Free GPU access:</strong> Train deep learning models without expensive hardware</li>
<li><strong>Reproducibility:</strong> Notebooks can be shared and rerun by collaborators</li>
<li><strong>COARE compatibility:</strong> Skills transfer to DOST’s COARE HPC environment</li>
</ul>
</div>
</div>
</section>
<section id="creating-your-first-colab-notebook" class="level3">
<h3 class="anchored" data-anchor-id="creating-your-first-colab-notebook">Creating Your First Colab Notebook</h3>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Access Colab
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>URL:</strong> <a href="https://colab.research.google.com">https://colab.research.google.com</a></p>
<p><strong>Requirements:</strong> - Google account - Modern web browser (Chrome, Firefox, Safari, Edge) - Stable internet connection</p>
</div>
</div>
<p><strong>Steps:</strong></p>
<ol type="1">
<li>Go to colab.research.google.com</li>
<li>Sign in with your Google account</li>
<li>Click <strong>File → New Notebook</strong></li>
<li>Rename: <strong>File → Rename</strong> → “Day1_Session3_Geospatial_Python”</li>
</ol>
</section>
<section id="understanding-the-colab-interface" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-colab-interface">Understanding the Colab Interface</h3>
<p><strong>Key components:</strong></p>
<ul>
<li><strong>Code cells:</strong> Where you write Python code (click or press Enter to edit)</li>
<li><strong>Text cells:</strong> Markdown for documentation (Insert → Text cell)</li>
<li><strong>Run button:</strong> ▶ Execute current cell (or press Shift+Enter)</li>
<li><strong>Runtime menu:</strong> Manage execution environment (restart, change runtime type)</li>
<li><strong>Table of Contents:</strong> Navigate long notebooks (left sidebar icon)</li>
</ul>
<p><strong>Try it:</strong> Create a code cell and run:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Hello from Google Colab!"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"This is the CoPhil EO AI/ML Training"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check Python version</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Python version: </span><span class="sc">{</span>sys<span class="sc">.</span>version<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Press <strong>Shift+Enter</strong> to execute. You should see the output below the cell.</p>
</section>
<section id="connecting-google-drive" class="level3">
<h3 class="anchored" data-anchor-id="connecting-google-drive">Connecting Google Drive</h3>
<p><strong>Why mount Google Drive?</strong></p>
<ul>
<li>Access data files stored in Drive</li>
<li>Save outputs permanently (Colab sessions are temporary!)</li>
<li>Share data with collaborators</li>
<li>Store trained models and results</li>
</ul>
<p><strong>Mount Drive:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> google.colab <span class="im">import</span> drive</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>drive.mount(<span class="st">'/content/drive'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What happens:</strong></p>
<ol type="1">
<li>Click the link that appears</li>
<li>Select your Google account</li>
<li>Click “Allow” to grant access</li>
<li>Copy the authorization code</li>
<li>Paste into the input field and press Enter</li>
</ol>
<p><strong>Verification:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>os.listdir(<span class="st">'/content/drive/MyDrive'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You should see your Google Drive folders listed!</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Organizing Your Data
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a folder structure in Google Drive for this training:</p>
<pre><code>MyDrive/
  CoPhil_Training/
    data/
      vector/          # Shapefiles, GeoJSON (Philippine boundaries, AOIs)
      raster/          # Satellite imagery (Sentinel-2 tiles, NDVI, etc.)
    outputs/           # Processed results (clipped rasters, classification maps)
    notebooks/         # Saved Colab notebooks</code></pre>
<p><strong>Pro Tip:</strong> Use descriptive filenames with dates: <code>palawan_sentinel2_20240615.tif</code></p>
<p>This keeps your training materials organized and makes paths easier to reference in code.</p>
</div>
</div>
</section>
<section id="understanding-colab-runtime" class="level3">
<h3 class="anchored" data-anchor-id="understanding-colab-runtime">Understanding Colab Runtime</h3>
<p><strong>Runtime Types:</strong></p>
<ul>
<li><strong>CPU:</strong> Default, free, sufficient for most geospatial tasks</li>
<li><strong>GPU:</strong> Free, excellent for deep learning (Sessions 5-7)</li>
<li><strong>TPU:</strong> Free, specialized for TensorFlow models</li>
</ul>
<p><strong>Session Limits:</strong></p>
<ul>
<li><strong>Idle timeout:</strong> 90 minutes of inactivity</li>
<li><strong>Maximum runtime:</strong> 12 hours continuous execution</li>
<li><strong>Disk space:</strong> ~100 GB temporary storage</li>
</ul>
<p><strong>Best Practices:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Periodically save important results to Drive</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shutil</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>shutil.copy(<span class="st">'important_result.tif'</span>, <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-3-installing-geospatial-libraries" class="level2">
<h2 class="anchored" data-anchor-id="part-3-installing-geospatial-libraries">Part 3: Installing Geospatial Libraries</h2>
<section id="required-libraries" class="level3">
<h3 class="anchored" data-anchor-id="required-libraries">Required Libraries</h3>
<p>Google Colab comes with many libraries pre-installed (NumPy, Pandas, Matplotlib), but specialized geospatial tools need installation.</p>
<p><strong>Core libraries we’ll use:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 27%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Library</th>
<th>Purpose</th>
<th>Why Important</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>GeoPandas</strong></td>
<td>Vector data (shapefiles, GeoJSON, polygons, points)</td>
<td>Spatial operations, CRS transforms, easy plotting</td>
</tr>
<tr class="even">
<td><strong>Rasterio</strong></td>
<td>Raster data (GeoTIFF, satellite imagery)</td>
<td>Read/write rasters, metadata, windowed reading</td>
</tr>
<tr class="odd">
<td><strong>Shapely</strong></td>
<td>Geometric operations (included with GeoPandas)</td>
<td>Create/manipulate geometries, spatial predicates</td>
</tr>
<tr class="even">
<td><strong>Matplotlib</strong></td>
<td>Visualization</td>
<td>Publication-quality figures, customizable plots</td>
</tr>
<tr class="odd">
<td><strong>NumPy</strong></td>
<td>Array operations (pre-installed)</td>
<td>Foundation for all numerical computing</td>
</tr>
</tbody>
</table>
</section>
<section id="installation" class="level3">
<h3 class="anchored" data-anchor-id="installation">Installation</h3>
<p>Run this cell (may take 1-2 minutes):</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install geospatial libraries</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install geopandas rasterio fiona shapely pyproj <span class="op">-</span>q</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Installation complete! ✓"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The <code>-q</code> flag makes installation quiet (less output).</p>
<p><strong>What’s being installed:</strong></p>
<ul>
<li><code>geopandas</code>: Main vector library (also installs Pandas)</li>
<li><code>rasterio</code>: Main raster library (also installs GDAL bindings)</li>
<li><code>fiona</code>: File I/O for vector formats (dependency of GeoPandas)</li>
<li><code>shapely</code>: Geometric operations (dependency of GeoPandas)</li>
<li><code>pyproj</code>: Coordinate reference system transformations</li>
</ul>
<p><strong>If you see warnings:</strong> Usually safe to ignore. If errors occur, try:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install <span class="op">--</span>upgrade geopandas rasterio</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="verify-installation" class="level3">
<h3 class="anchored" data-anchor-id="verify-installation">Verify Installation</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ GeoPandas version:"</span>, gpd.__version__)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Rasterio version:"</span>, rasterio.__version__)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ NumPy version:"</span>, np.__version__)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ All libraries imported successfully!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Warning</span>Runtime Restart
</div>
</div>
<div class="callout-body-container callout-body">
<p>Occasionally, Colab may ask you to restart the runtime after installing libraries:</p>
<p><strong>Runtime → Restart runtime</strong></p>
<p>Then re-run your import cell. This is normal and ensures clean library loading!</p>
</div>
</div>
<hr>
</section>
</section>
<section id="part-4-python-basics-refresher" class="level2">
<h2 class="anchored" data-anchor-id="part-4-python-basics-refresher">Part 4: Python Basics Refresher</h2>
<p>Quick recap of Python essentials for geospatial work:</p>
<section id="data-types" class="level3">
<h3 class="anchored" data-anchor-id="data-types">Data Types</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Numbers</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>population <span class="op">=</span> <span class="dv">1780148</span>        <span class="co"># Integer</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>area_km2 <span class="op">=</span> <span class="fl">42.88</span>           <span class="co"># Float</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Strings</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>city <span class="op">=</span> <span class="st">"Manila"</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>province <span class="op">=</span> <span class="st">"Metro Manila"</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Lists (ordered collections)</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>regions <span class="op">=</span> [<span class="st">"Luzon"</span>, <span class="st">"Visayas"</span>, <span class="st">"Mindanao"</span>]</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>coordinates <span class="op">=</span> [<span class="fl">14.5995</span>, <span class="fl">120.9842</span>]  <span class="co"># [latitude, longitude]</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Dictionaries (key-value pairs)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>location_info <span class="op">=</span> {</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"city"</span>: <span class="st">"Quezon City"</span>,</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"population"</span>: <span class="dv">2960048</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"region"</span>: <span class="st">"NCR"</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>city<span class="sc">}</span><span class="ss"> has population </span><span class="sc">{</span>population<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Regions: </span><span class="sc">{</span>regions<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinates: </span><span class="sc">{</span>coordinates<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="control-structures" class="level3">
<h3 class="anchored" data-anchor-id="control-structures">Control Structures</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If statements</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>cloud_cover <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> cloud_cover <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Excellent"</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="cf">elif</span> cloud_cover <span class="op">&lt;</span> <span class="dv">30</span>:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Good"</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    quality <span class="op">=</span> <span class="st">"Poor"</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Cloud cover </span><span class="sc">{</span>cloud_cover<span class="sc">}</span><span class="ss">%: </span><span class="sc">{</span>quality<span class="sc">}</span><span class="ss"> for optical imagery"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># For loops</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> [<span class="st">"Palawan"</span>, <span class="st">"Zambales"</span>, <span class="st">"Quezon"</span>]</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> province <span class="kw">in</span> provinces:</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Processing </span><span class="sc">{</span>province<span class="sc">}</span><span class="ss">..."</span>)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="co"># List comprehension (Pythonic way)</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>province_lengths <span class="op">=</span> [<span class="bu">len</span>(p) <span class="cf">for</span> p <span class="kw">in</span> provinces]</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Province name lengths:"</span>, province_lengths)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="functions" class="level3">
<h3 class="anchored" data-anchor-id="functions">Functions</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_ndvi(nir, red):</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Calculate Normalized Difference Vegetation Index.</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">    nir : float or ndarray</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Near-infrared reflectance values</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="co">    red : float or ndarray</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Red reflectance values</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co">    ndvi : float or ndarray</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="co">        NDVI values ranging from -1 to +1</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add small value to avoid division by zero</span></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ndvi</span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>nir_value <span class="op">=</span> <span class="fl">0.8</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>red_value <span class="op">=</span> <span class="fl">0.2</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>result <span class="op">=</span> calculate_ndvi(nir_value, red_value)</span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI: </span><span class="sc">{</span>result<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Key Python concepts for geospatial:</strong></p>
<ul>
<li><strong>Indentation matters:</strong> Use 4 spaces to define code blocks</li>
<li><strong>0-indexed:</strong> First element is <code>list[0]</code>, not <code>list[1]</code></li>
<li><strong>Method chaining:</strong> <code>gdf.filter(...).plot()</code> applies operations sequentially</li>
<li><strong>Context managers:</strong> <code>with rasterio.open() as src:</code> auto-closes files (prevents memory leaks)</li>
</ul>
<hr>
</section>
</section>
<section id="part-5-vector-data-with-geopandas" class="level2">
<h2 class="anchored" data-anchor-id="part-5-vector-data-with-geopandas">Part 5: Vector Data with GeoPandas</h2>
<section id="what-is-vector-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-vector-data">What is Vector Data?</h3>
<p><strong>Vector data represents discrete features as geometric objects:</strong></p>
<ul>
<li><strong>Points:</strong> Cities, field sites, observation locations, GPS waypoints</li>
<li><strong>Lines (LineStrings):</strong> Roads, rivers, transects, boundaries</li>
<li><strong>Polygons:</strong> Administrative boundaries, land parcels, watersheds, protected areas</li>
</ul>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">graph TB
    subgraph VectorTypes["VECTOR GEOMETRY TYPES"]
        V1[Point&lt;br/&gt;Single coordinate&lt;br/&gt;Cities, GPS points]
        V2[LineString&lt;br/&gt;Connected coordinates&lt;br/&gt;Roads, rivers]
        V3[Polygon&lt;br/&gt;Closed ring&lt;br/&gt;Boundaries, parcels]
        V4[MultiPoint&lt;br/&gt;Multiple points&lt;br/&gt;Observation sites]
        V5[MultiLineString&lt;br/&gt;Multiple lines&lt;br/&gt;Road networks]
        V6[MultiPolygon&lt;br/&gt;Multiple polygons&lt;br/&gt;Archipelago]
    end

    subgraph GDF["GEOPANDAS GEODATAFRAME"]
        GDF1[Geometry Column&lt;br/&gt;Shapely objects&lt;br/&gt;Point/Line/Polygon]
        GDF2[Attribute Columns&lt;br/&gt;Name, Population&lt;br/&gt;Area, Type, etc.]
        GDF3[CRS Information&lt;br/&gt;EPSG:4326, 32651&lt;br/&gt;Projection metadata]
        GDF4[Spatial Index&lt;br/&gt;R-tree for fast&lt;br/&gt;spatial queries]
    end

    subgraph Formats["FILE FORMATS"]
        F1[Shapefile&lt;br/&gt;.shp + .shx + .dbf + .prj]
        F2[GeoJSON&lt;br/&gt;.geojson, .json]
        F3[GeoPackage&lt;br/&gt;.gpkg]
        F4[KML/KMZ&lt;br/&gt;.kml, .kmz]
    end

    V1 --&gt; GDF1
    V2 --&gt; GDF1
    V3 --&gt; GDF1

    GDF1 --&gt; Operations[Spatial Operations&lt;br/&gt;Buffer, Intersect&lt;br/&gt;Union, Dissolve&lt;br/&gt;Clip, Overlay]
    GDF2 --&gt; Operations
    GDF3 --&gt; Operations

    F1 --&gt;|gpd.read_file| GDF
    F2 --&gt;|gpd.read_file| GDF
    F3 --&gt;|gpd.read_file| GDF

    style VectorTypes fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style GDF fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style Formats fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style Operations fill:#ffe6ff,stroke:#cc00cc,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Vector Data Types and GeoPandas GeoDataFrame Structure</figcaption> </figure><p></p>
</div>
</div>
</div>
<p><strong>Common formats:</strong> Shapefile (.shp + .shx + .dbf + .prj), GeoJSON (.geojson, .json), KML (.kml), GeoPackage (.gpkg)</p>
<p><strong>Shapefile components:</strong> - <code>.shp</code>: Geometry (points, lines, polygons) - <code>.shx</code>: Shape index - <code>.dbf</code>: Attribute table (database) - <code>.prj</code>: Coordinate reference system - <code>.cpg</code>: Character encoding (optional)</p>
</section>
<section id="understanding-coordinate-reference-systems-crs" class="level3">
<h3 class="anchored" data-anchor-id="understanding-coordinate-reference-systems-crs">Understanding Coordinate Reference Systems (CRS)</h3>
<p>Before we load data, it’s essential to understand CRS - a critical concept for accurate geospatial analysis.</p>
<p><strong>What is a CRS?</strong></p>
<p>A Coordinate Reference System defines how coordinates map to locations on Earth. It consists of:</p>
<ol type="1">
<li><strong>Coordinate System:</strong> Geographic (lat/lon) or Projected (x/y in meters)</li>
<li><strong>Datum:</strong> Reference ellipsoid approximating Earth’s shape (e.g., WGS84)</li>
<li><strong>Projection:</strong> Mathematical transformation from 3D Earth to 2D map</li>
</ol>
<p><strong>Common CRS for Philippines:</strong></p>
<table class="caption-top table">
<colgroup>
<col style="width: 27%">
<col style="width: 15%">
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>EPSG Code</th>
<th>Name</th>
<th>Type</th>
<th>Units</th>
<th>Use Case</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>4326</strong></td>
<td>WGS84</td>
<td>Geographic</td>
<td>Degrees</td>
<td>GPS, web maps, global datasets</td>
</tr>
<tr class="even">
<td><strong>32651</strong></td>
<td>UTM Zone 51N</td>
<td>Projected</td>
<td>Meters</td>
<td>Northern/Western Philippines</td>
</tr>
<tr class="odd">
<td><strong>32652</strong></td>
<td>UTM Zone 52N</td>
<td>Projected</td>
<td>Meters</td>
<td>Eastern Philippines</td>
</tr>
<tr class="even">
<td><strong>3123</strong></td>
<td>PRS92 / Philippines Zone III</td>
<td>Projected</td>
<td>Meters</td>
<td>Philippine national standard</td>
</tr>
</tbody>
</table>
<p><strong>Why CRS matters:</strong></p>
<ul>
<li><strong>Distance calculations:</strong> Geographic CRS (degrees) gives wrong distances; use projected CRS (meters)</li>
<li><strong>Area calculations:</strong> Same issue - must use projected CRS for accurate areas</li>
<li><strong>Spatial operations:</strong> CRS must match for intersections, buffers, clipping</li>
<li><strong>Visualization:</strong> Web maps expect EPSG:4326; analysis needs meters</li>
</ul>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[GPS Data&lt;br/&gt;EPSG:4326&lt;br/&gt;Lat: 14.5995°&lt;br/&gt;Lon: 120.9842°] --&gt; B{Need distance&lt;br/&gt;or area&lt;br/&gt;calculations?}

    B --&gt;|Yes| C[Transform to&lt;br/&gt;Projected CRS&lt;br/&gt;UTM Zone 51N&lt;br/&gt;EPSG:32651]

    B --&gt;|No, just&lt;br/&gt;visualization| D[Keep Geographic&lt;br/&gt;EPSG:4326&lt;br/&gt;For web maps]

    C --&gt; E[Accurate Calculations&lt;br/&gt;X: 279,000 m&lt;br/&gt;Y: 1,615,000 m]

    E --&gt; F[Spatial Operations&lt;br/&gt;Buffer 1000m&lt;br/&gt;Calculate area in km²&lt;br/&gt;Distance in meters]

    F --&gt; G{Export for&lt;br/&gt;web mapping?}

    G --&gt;|Yes| H[Transform back&lt;br/&gt;to EPSG:4326]
    G --&gt;|No| I[Save in UTM&lt;br/&gt;For further analysis]

    H --&gt; D

    D --&gt; J[Interactive Map&lt;br/&gt;Folium, Leaflet&lt;br/&gt;Google Maps]

    subgraph PhilippineCRS["PHILIPPINE CRS OPTIONS"]
        P1[EPSG:4326&lt;br/&gt;WGS84 Geographic&lt;br/&gt;Global standard]
        P2[EPSG:32651&lt;br/&gt;UTM Zone 51N&lt;br/&gt;Western PH]
        P3[EPSG:32652&lt;br/&gt;UTM Zone 52N&lt;br/&gt;Eastern PH]
        P4[EPSG:3123&lt;br/&gt;PRS92 Zone III&lt;br/&gt;National standard]
    end

    C -.-&gt;|Choose| P2
    C -.-&gt;|Choose| P3
    C -.-&gt;|Choose| P4

    style A fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style C fill:#ffe6e6,stroke:#cc0044,stroke-width:2px
    style E fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style D fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style PhilippineCRS fill:#f0e6ff,stroke:#6666cc,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Coordinate Reference System Transformation Workflow</figcaption> </figure><p></p>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Philippine UTM Zones
</div>
</div>
<div class="callout-body-container callout-body">
<p>The Philippines spans <strong>two UTM zones:</strong></p>
<ul>
<li><strong>UTM Zone 51N (EPSG:32651):</strong> Covers western Philippines including Manila, Palawan, western Luzon, western Visayas</li>
<li><strong>UTM Zone 52N (EPSG:32652):</strong> Covers eastern Philippines including Mindanao, eastern Visayas, Bicol</li>
</ul>
<p><strong>Rule of thumb:</strong> Manila and most populated areas use Zone 51N. When in doubt, check your AOI’s central longitude: - Longitude &lt; 120° → Zone 51N - Longitude ≥ 120° → Zone 52N</p>
<p>For national-scale analysis, <strong>PRS92 (EPSG:3123)</strong> is the Philippine standard.</p>
</div>
</div>
</section>
<section id="loading-philippine-administrative-boundaries" class="level3">
<h3 class="anchored" data-anchor-id="loading-philippine-administrative-boundaries">Loading Philippine Administrative Boundaries</h3>
<p>Let’s load provincial boundaries of the Philippines:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 1: From Google Drive (if you uploaded data)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>provinces <span class="op">=</span> gpd.read_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/philippines_provinces.shp'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Option 2: From URL (using sample data from PhilGIS)</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://raw.githubusercontent.com/altcoder/philippines-json-maps/master/geojson/provinces/hires/BOHOL.json"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>sample_province <span class="op">=</span> gpd.read_file(url)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># For this example, let's use the sample</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>gdf <span class="op">=</span> sample_province</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Loaded successfully! ✓"</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data type: </span><span class="sc">{</span><span class="bu">type</span>(gdf)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="philippine-geospatial-data-sources" class="level3 philippine-context">
<h3 class="anchored" data-anchor-id="philippine-geospatial-data-sources">Philippine Geospatial Data Sources</h3>
<p><strong>Official Government Sources:</strong> - <strong>NAMRIA Geoportal:</strong> Official administrative boundaries, topographic maps - Website: https://www.namria.gov.ph/ - Note: May require registration for downloads - <strong>PhilGIS:</strong> Open-source Philippine GIS data repository - Roads, rivers, boundaries, land use - <strong>PSA (Philippine Statistics Authority):</strong> Statistical boundaries matching census data - <strong>LMB (Land Management Bureau):</strong> Cadastral boundaries, land parcel data</p>
<p><strong>Open Data Platforms:</strong> - <strong>GADM:</strong> Global Administrative Areas - free Philippine boundaries - Website: https://gadm.org/download_country.html (select Philippines) - <strong>OpenStreetMap (OSM):</strong> Roads, buildings, POIs, waterways - Export via: https://export.hotosm.org/ or Overpass Turbo - <strong>Humanitarian Data Exchange (HDX):</strong> Disaster-related boundaries and data - <strong>PhilSA Data Portal:</strong> Satellite-derived products and boundaries</p>
<p><strong>Pro Tip:</strong> Download shapefiles to your Google Drive <code>data/vector/</code> folder before the session for offline access.</p>
</section>
<section id="inspecting-a-geodataframe" class="level3">
<h3 class="anchored" data-anchor-id="inspecting-a-geodataframe">Inspecting a GeoDataFrame</h3>
<p><strong>View first rows:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>gdf.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This shows: - Attribute columns (NAME, PROVINCE, REGION, ADM1_EN, etc.) - <strong>geometry column:</strong> The shapes themselves (Polygon or MultiPolygon)</p>
<p><strong>Check coordinate reference system:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS:"</span>, gdf.crs)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"CRS name:"</span>, gdf.crs.name <span class="cf">if</span> gdf.crs <span class="cf">else</span> <span class="st">"Not defined"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Get basic information:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Number of features: </span><span class="sc">{</span><span class="bu">len</span>(gdf)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Geometry type: </span><span class="sc">{</span>gdf<span class="sc">.</span>geometry<span class="sc">.</span><span class="bu">type</span>[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Bounds (minx, miny, maxx, maxy): </span><span class="sc">{</span>gdf<span class="sc">.</span>total_bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Columns:</span><span class="ch">\n</span><span class="sc">{</span><span class="bu">list</span>(gdf.columns)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Summary statistics:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>gdf.info()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Understand geometry details:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First geometry</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>first_geom <span class="op">=</span> gdf.geometry.iloc[<span class="dv">0</span>]</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Geometry type: </span><span class="sc">{</span>first_geom<span class="sc">.</span>geom_type<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Is valid: </span><span class="sc">{</span>first_geom<span class="sc">.</span>is_valid<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Coordinate count: </span><span class="sc">{</span><span class="bu">len</span>(first_geom.exterior.coords)<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># For Polygon</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="working-with-coordinate-reference-systems" class="level3">
<h3 class="anchored" data-anchor-id="working-with-coordinate-reference-systems">Working with Coordinate Reference Systems</h3>
<p><strong>Check current CRS:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Original CRS:"</span>, gdf.crs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Reproject to UTM Zone 51N (for Manila area):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Transform to UTM 51N for accurate distance/area calculations</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>gdf_utm <span class="op">=</span> gdf.to_crs(<span class="st">'EPSG:32651'</span>)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Reprojected CRS:"</span>, gdf_utm.crs)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare bounds in degrees vs meters</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Original bounds (degrees):"</span>, gdf.total_bounds)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"UTM bounds (meters):"</span>, gdf_utm.total_bounds)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Use Which CRS?
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Use Geographic CRS (EPSG:4326) for:</strong> - Loading data (most sources provide data in WGS84) - Web mapping and visualization - Storing data for sharing</p>
<p><strong>Use Projected CRS (UTM or PRS92) for:</strong> - Distance calculations: <code>gdf.geometry.length</code> - Area calculations: <code>gdf.geometry.area</code> - Buffer operations: <code>gdf.geometry.buffer(1000)</code> for 1 km buffer - Spatial analysis requiring metric units</p>
<p><strong>Workflow:</strong> 1. Load data (usually in EPSG:4326) 2. Reproject to appropriate UTM zone 3. Perform spatial operations 4. Optionally reproject back to EPSG:4326 for web display</p>
</div>
</div>
</section>
<section id="calculating-geometric-properties" class="level3">
<h3 class="anchored" data-anchor-id="calculating-geometric-properties">Calculating Geometric Properties</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area in square kilometers</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>gdf_utm[<span class="st">'area_km2'</span>] <span class="op">=</span> gdf_utm.geometry.area <span class="op">/</span> <span class="dv">1_000_000</span>  <span class="co"># m² to km²</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Province area: </span><span class="sc">{</span>gdf_utm[<span class="st">'area_km2'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> km²"</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate perimeter</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>gdf_utm[<span class="st">'perimeter_km'</span>] <span class="op">=</span> gdf_utm.geometry.length <span class="op">/</span> <span class="dv">1000</span>  <span class="co"># m to km</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Province perimeter: </span><span class="sc">{</span>gdf_utm[<span class="st">'perimeter_km'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">:.2f}</span><span class="ss"> km"</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate centroid (in original CRS)</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'centroid'</span>] <span class="op">=</span> gdf.geometry.centroid</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Centroid coordinates: </span><span class="sc">{</span>gdf[<span class="st">'centroid'</span>]<span class="sc">.</span>iloc[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display updated GeoDataFrame</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>gdf_utm[[<span class="st">'area_km2'</span>, <span class="st">'perimeter_km'</span>]].head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="filtering-and-querying" class="level3">
<h3 class="anchored" data-anchor-id="filtering-and-querying">Filtering and Querying</h3>
<p><strong>Filter by attribute:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If using multi-province dataset:</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># luzon_provinces = gdf[gdf['ISLAND'] == 'LUZON']</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter by area (if area column exists or was calculated)</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>large_provinces <span class="op">=</span> gdf_utm[gdf_utm[<span class="st">'area_km2'</span>] <span class="op">&gt;</span> <span class="dv">5000</span>]</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Provinces larger than 5000 km²: </span><span class="sc">{</span><span class="bu">len</span>(large_provinces)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Select specific province by name</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>target <span class="op">=</span> gdf[gdf[<span class="st">'NAME'</span>].<span class="bu">str</span>.contains(<span class="st">'Bohol'</span>, case<span class="op">=</span><span class="va">False</span>)]</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Selected: </span><span class="sc">{</span>target[<span class="st">'NAME'</span>]<span class="sc">.</span>values<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Multiple conditions</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="co"># coastal_large = gdf[(gdf['area_km2'] &gt; 3000) &amp; (gdf['coastal'] == True)]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Spatial filtering:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if geometries are valid</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Valid geometries: </span><span class="sc">{</span>gdf<span class="sc">.</span>geometry<span class="sc">.</span>is_valid<span class="sc">.</span><span class="bu">all</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co"># If invalid, fix them</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> gdf.geometry.is_valid.<span class="bu">all</span>():</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    gdf[<span class="st">'geometry'</span>] <span class="op">=</span> gdf.geometry.<span class="bu">buffer</span>(<span class="dv">0</span>)  <span class="co"># Common fix for invalid geometries</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Spatial predicate example: find features within a bounding box</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>bbox <span class="op">=</span> (<span class="fl">123.5</span>, <span class="fl">9.5</span>, <span class="fl">125.0</span>, <span class="fl">11.0</span>)  <span class="co"># (minx, miny, maxx, maxy)</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> box</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>bbox_geom <span class="op">=</span> box(<span class="op">*</span>bbox)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>within_bbox <span class="op">=</span> gdf[gdf.geometry.within(bbox_geom)]</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features within bounding box: </span><span class="sc">{</span><span class="bu">len</span>(within_bbox)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="spatial-operations" class="level3">
<h3 class="anchored" data-anchor-id="spatial-operations">Spatial Operations</h3>
<p><strong>Buffer (create zone around feature):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 10 km buffer around province (must use projected CRS!)</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>buffer_10km <span class="op">=</span> gdf_utm.geometry.<span class="bu">buffer</span>(<span class="dv">10000</span>)  <span class="co"># 10,000 meters</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize original and buffer</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>gdf_utm.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'lightblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Province'</span>)</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>buffer_10km.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, label<span class="op">=</span><span class="st">'10 km buffer'</span>)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Province with 10 km Buffer"</span>)</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Dissolve (merge features):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have multiple provinces, dissolve by region</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dissolved = gdf.dissolve(by='REGION', aggfunc='sum')  # Aggregates numeric columns</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Spatial joins:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Join point data to polygons (e.g., field sites to provinces)</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># points_gdf = gpd.read_file('field_sites.shp')</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="co"># joined = gpd.sjoin(points_gdf, gdf, how='left', predicate='within')</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># This adds province attributes to each point based on which polygon contains it</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="visualizing-vector-data" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-vector-data">Visualizing Vector Data</h3>
<p><strong>Simple plot:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>gdf.plot(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">8</span>), edgecolor<span class="op">=</span><span class="st">'black'</span>, facecolor<span class="op">=</span><span class="st">'lightblue'</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bohol Province, Philippines"</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Styled plot with colors:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># If you have multiple provinces with a classification column:</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co"># gdf.plot(column='REGION', legend=True, figsize=(10, 10),</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="co">#          cmap='Set3', edgecolor='black', linewidth=0.5)</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.title("Philippines Provinces by Region")</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For single feature, style it:</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'#90EE90'</span>, edgecolor<span class="op">=</span><span class="st">'darkgreen'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>gdf[<span class="st">'centroid'</span>].plot(ax<span class="op">=</span>ax, color<span class="op">=</span><span class="st">'red'</span>, markersize<span class="op">=</span><span class="dv">50</span>, label<span class="op">=</span><span class="st">'Centroid'</span>)</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Bohol Province with Centroid"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Longitude"</span>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Latitude"</span>)</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Interactive map with Folium:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Install folium if not already available</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install folium <span class="op">-</span>q</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> folium</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Get centroid for map center</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>centroid <span class="op">=</span> gdf.geometry.centroid.iloc[<span class="dv">0</span>]</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>center <span class="op">=</span> [centroid.y, centroid.x]  <span class="co"># folium expects [lat, lon]</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create map</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>m <span class="op">=</span> folium.Map(location<span class="op">=</span>center, zoom_start<span class="op">=</span><span class="dv">9</span>, tiles<span class="op">=</span><span class="st">'OpenStreetMap'</span>)</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Add GeoDataFrame to map</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>folium.GeoJson(</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>    gdf,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    name<span class="op">=</span><span class="st">'Province Boundary'</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    style_function<span class="op">=</span><span class="kw">lambda</span> x: {<span class="st">'fillColor'</span>: <span class="st">'lightblue'</span>, <span class="st">'color'</span>: <span class="st">'darkblue'</span>, <span class="st">'weight'</span>: <span class="dv">2</span>}</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add marker at centroid</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>folium.Marker(</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>    location<span class="op">=</span>center,</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    popup<span class="op">=</span><span class="st">'Province Centroid'</span>,</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>    icon<span class="op">=</span>folium.Icon(color<span class="op">=</span><span class="st">'red'</span>, icon<span class="op">=</span><span class="st">'info-sign'</span>)</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>).add_to(m)</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display map</span></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>m</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="creating-area-of-interest-aoi-geometries" class="level3">
<h3 class="anchored" data-anchor-id="creating-area-of-interest-aoi-geometries">Creating Area of Interest (AOI) Geometries</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> shapely.geometry <span class="im">import</span> Polygon, Point, LineString</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple polygon AOI (example coordinates)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>aoi_coords <span class="op">=</span> [</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">9.5</span>),   <span class="co"># Southwest corner</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">125.0</span>, <span class="fl">9.5</span>),   <span class="co"># Southeast corner</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">125.0</span>, <span class="fl">11.0</span>),  <span class="co"># Northeast corner</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">11.0</span>),  <span class="co"># Northwest corner</span></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>    (<span class="fl">123.5</span>, <span class="fl">9.5</span>)    <span class="co"># Close polygon (first point repeated)</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>aoi_polygon <span class="op">=</span> Polygon(aoi_coords)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>aoi_gdf <span class="op">=</span> gpd.GeoDataFrame([<span class="dv">1</span>], geometry<span class="op">=</span>[aoi_polygon], crs<span class="op">=</span><span class="st">'EPSG:4326'</span>)</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>aoi_gdf.columns <span class="op">=</span> [<span class="st">'id'</span>, <span class="st">'geometry'</span>]</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize AOI with province</span></span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'lightgray'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, label<span class="op">=</span><span class="st">'Province'</span>)</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>aoi_gdf.plot(ax<span class="op">=</span>ax, facecolor<span class="op">=</span><span class="st">'none'</span>, edgecolor<span class="op">=</span><span class="st">'red'</span>, linewidth<span class="op">=</span><span class="dv">3</span>, label<span class="op">=</span><span class="st">'AOI'</span>)</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Province with Area of Interest (Red Box)"</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"AOI created successfully! ✓"</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"AOI bounds: </span><span class="sc">{</span>aoi_gdf<span class="sc">.</span>total_bounds<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Save AOI for later use:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as shapefile</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>aoi_gdf.to_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/my_aoi.shp'</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or save as GeoJSON (more portable)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>aoi_gdf.to_file(<span class="st">'/content/drive/MyDrive/CoPhil_Training/data/vector/my_aoi.geojson'</span>, driver<span class="op">=</span><span class="st">'GeoJSON'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-6-raster-data-with-rasterio" class="level2">
<h2 class="anchored" data-anchor-id="part-6-raster-data-with-rasterio">Part 6: Raster Data with Rasterio</h2>
<section id="what-is-raster-data" class="level3">
<h3 class="anchored" data-anchor-id="what-is-raster-data">What is Raster Data?</h3>
<p><strong>Raster data is a grid of pixels (cells), each with a value:</strong></p>
<ul>
<li><strong>Satellite imagery:</strong> Each pixel = reflectance values (0-10000 for Sentinel-2)</li>
<li><strong>DEMs (Digital Elevation Models):</strong> Each pixel = elevation in meters</li>
<li><strong>Temperature maps:</strong> Each pixel = temperature value</li>
<li><strong>Classification maps:</strong> Each pixel = land cover class ID</li>
</ul>
<div class="cell" data-fig-width="100%" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">flowchart TD
    A[Sentinel-2 GeoTIFF&lt;br/&gt;Multi-band raster&lt;br/&gt;13 spectral bands] --&gt; B[Open with Rasterio&lt;br/&gt;rasterio.open]

    B --&gt; C[Read Metadata&lt;br/&gt;CRS, Transform&lt;br/&gt;Bounds, Resolution&lt;br/&gt;Band count]

    C --&gt; D[Read Band Data&lt;br/&gt;src.read&lt;br/&gt;NumPy arrays]

    D --&gt; E{Processing&lt;br/&gt;Goal?}

    E --&gt;|Calculate Index| F[NDVI Calculation&lt;br/&gt;NIR - Red / NIR + Red&lt;br/&gt;NumPy operations]

    E --&gt;|Create Composite| G[RGB Composite&lt;br/&gt;Stack bands&lt;br/&gt;Normalize values]

    E --&gt;|Clip to AOI| H[Vector Mask&lt;br/&gt;GeoDataFrame boundary&lt;br/&gt;rasterio.mask.mask]

    E --&gt;|Resample| I[Change Resolution&lt;br/&gt;Upsample/Downsample&lt;br/&gt;Resampling method]

    F --&gt; J[Write Output&lt;br/&gt;rasterio.open 'w'&lt;br/&gt;Copy metadata&lt;br/&gt;Write array]

    G --&gt; J
    H --&gt; J
    I --&gt; J

    J --&gt; K[New GeoTIFF&lt;br/&gt;Processed raster&lt;br/&gt;Ready for ML]

    subgraph RasterOps["RASTER OPERATIONS"]
        R1[Arithmetic&lt;br/&gt;Add, Subtract&lt;br/&gt;Multiply, Divide]
        R2[Logical&lt;br/&gt;Masks, Filters&lt;br/&gt;Thresholds]
        R3[Statistics&lt;br/&gt;Mean, Std, Min&lt;br/&gt;Max, Percentiles]
        R4[Spatial&lt;br/&gt;Clip, Mosaic&lt;br/&gt;Reproject]
    end

    D --&gt; RasterOps

    style A fill:#e6f3ff,stroke:#0066cc,stroke-width:2px
    style C fill:#fff4e6,stroke:#ff8800,stroke-width:2px
    style D fill:#e6ffe6,stroke:#00aa44,stroke-width:2px
    style J fill:#ffe6ff,stroke:#cc00cc,stroke-width:2px
    style K fill:#ccffcc,stroke:#00aa44,stroke-width:2px
    style RasterOps fill:#ffe6e6,stroke:#cc0044,stroke-width:2px
</pre>
</div>
<p></p><figcaption> Raster Data Processing Workflow with Rasterio</figcaption> </figure><p></p>
</div>
</div>
</div>
<p><strong>Common formats:</strong> GeoTIFF (.tif, .tiff), NetCDF (.nc), HDF (.hdf, .h5), JPEG2000 (.jp2)</p>
<p><strong>Raster structure:</strong></p>
<pre><code>┌─────┬─────┬─────┬─────┐
│ 120 │ 130 │ 125 │ 118 │  ← Row 1 (top)
├─────┼─────┼─────┼─────┤
│ 115 │ 140 │ 135 │ 122 │  ← Row 2
├─────┼─────┼─────┼─────┤
│ 110 │ 125 │ 130 │ 119 │  ← Row 3 (bottom)
└─────┴─────┴─────┴─────┘
  ↑     ↑     ↑     ↑
 Col1  Col2  Col3  Col4
 (left)           (right)</code></pre>
<p>Each cell has: - <strong>Value:</strong> Reflectance, elevation, class, etc. - <strong>Location:</strong> Defined by geotransform + CRS - <strong>Size:</strong> Spatial resolution (e.g., 10m means 10m × 10m pixel)</p>
<p><strong>Geotransform:</strong> 6 coefficients that map pixel coordinates to geographic coordinates - <code>[x_origin, x_pixel_size, x_rotation, y_origin, y_rotation, y_pixel_size]</code> - Example: <code>[400000, 10, 0, 5000000, 0, -10]</code> → Origin at (400000, 5000000) UTM, 10m pixels</p>
</section>
<section id="understanding-sentinel-2-bands-and-resolution" class="level3">
<h3 class="anchored" data-anchor-id="understanding-sentinel-2-bands-and-resolution">Understanding Sentinel-2 Bands and Resolution</h3>
<p>Before opening rasters, let’s review Sentinel-2’s band structure (from Session 1):</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Band</th>
<th>Name</th>
<th>Wavelength (nm)</th>
<th>Resolution</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>B1</td>
<td>Coastal Aerosol</td>
<td>443</td>
<td>60m</td>
<td>Atmospheric correction</td>
</tr>
<tr class="even">
<td>B2</td>
<td>Blue</td>
<td>490</td>
<td><strong>10m</strong></td>
<td>Water body mapping, aerosol detection</td>
</tr>
<tr class="odd">
<td>B3</td>
<td>Green</td>
<td>560</td>
<td><strong>10m</strong></td>
<td>Vegetation vigor, water clarity</td>
</tr>
<tr class="even">
<td>B4</td>
<td>Red</td>
<td>665</td>
<td><strong>10m</strong></td>
<td>Chlorophyll absorption</td>
</tr>
<tr class="odd">
<td>B5</td>
<td>Red Edge 1</td>
<td>705</td>
<td>20m</td>
<td>Vegetation classification</td>
</tr>
<tr class="even">
<td>B6</td>
<td>Red Edge 2</td>
<td>740</td>
<td>20m</td>
<td>Vegetation stress</td>
</tr>
<tr class="odd">
<td>B7</td>
<td>Red Edge 3</td>
<td>783</td>
<td>20m</td>
<td>Vegetation monitoring</td>
</tr>
<tr class="even">
<td>B8</td>
<td>NIR</td>
<td>842</td>
<td><strong>10m</strong></td>
<td>Biomass, vegetation health</td>
</tr>
<tr class="odd">
<td>B8A</td>
<td>Narrow NIR</td>
<td>865</td>
<td>20m</td>
<td>Atmospheric correction</td>
</tr>
<tr class="even">
<td>B9</td>
<td>Water Vapor</td>
<td>945</td>
<td>60m</td>
<td>Atmospheric correction</td>
</tr>
<tr class="odd">
<td>B10</td>
<td>Cirrus</td>
<td>1373</td>
<td>60m</td>
<td>Cirrus cloud detection</td>
</tr>
<tr class="even">
<td>B11</td>
<td>SWIR 1</td>
<td>1610</td>
<td>20m</td>
<td>Snow/ice/cloud discrimination</td>
</tr>
<tr class="odd">
<td>B12</td>
<td>SWIR 2</td>
<td>2190</td>
<td>20m</td>
<td>Vegetation moisture</td>
</tr>
</tbody>
</table>
<p><strong>Key bands for this session:</strong> - <strong>10m bands (B2, B3, B4, B8):</strong> Best for detailed analysis, vegetation indices - <strong>20m bands (B5-B7, B8A, B11-B12):</strong> Useful for spectral indices requiring SWIR - <strong>60m bands (B1, B9, B10):</strong> Mostly for atmospheric correction, rarely used in analysis</p>
</section>
<section id="opening-a-raster-file" class="level3">
<h3 class="anchored" data-anchor-id="opening-a-raster-file">Opening a Raster File</h3>
<p><strong>Example: Sentinel-2 imagery subset</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample raster path (adjust to your data location)</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For demo, we'll show the workflow with a hypothetical path</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>raster_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/data/raster/sentinel2_bohol_subset.tif'</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># In real workflow, you'd download Sentinel-2 from Copernicus or GEE</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># For now, let's demonstrate with metadata inspection</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Open raster and view metadata</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span>:</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    src <span class="op">=</span> rasterio.<span class="bu">open</span>(raster_path)</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># View metadata</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Raster Metadata:"</span>)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Driver: </span><span class="sc">{</span>src<span class="sc">.</span>driver<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Width (pixels): </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Height (pixels): </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Number of bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Data type: </span><span class="sc">{</span>src<span class="sc">.</span>dtypes[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bounds: </span><span class="sc">{</span>src<span class="sc">.</span>bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Transform:</span><span class="ch">\n</span><span class="sc">{</span>src<span class="sc">.</span>transform<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Resolution: </span><span class="sc">{</span>src<span class="sc">.</span>res<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (x_res, y_res) in CRS units</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Nodata value: </span><span class="sc">{</span>src<span class="sc">.</span>nodata<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    src.close()</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="cf">except</span> <span class="pp">FileNotFoundError</span>:</span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"Sample raster file not found. We'll use a demonstration dataset."</span>)</span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="st">"In practice, you'd download Sentinel-2 data from Copernicus Data Space Ecosystem or Google Earth Engine."</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Understanding Raster Metadata
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>For a Sentinel-2 10m band over Bohol (hypothetical):</strong></p>
<ul>
<li><strong>Width/Height:</strong> 5490 x 5490 pixels → 54.9km x 54.9km area (standard Sentinel-2 tile)</li>
<li><strong>Bands:</strong> 1 (if single band file) or 4 (if RGB+NIR stack)</li>
<li><strong>Data type:</strong> uint16 (unsigned 16-bit integer, range 0-65535)
<ul>
<li>Sentinel-2 L2A: Reflectance scaled by 10000 (value 5000 = 50% reflectance)</li>
</ul></li>
<li><strong>CRS:</strong> EPSG:32651 (UTM Zone 51N for western Philippines)</li>
<li><strong>Resolution:</strong> (10.0, -10.0) meters
<ul>
<li>Positive x-resolution: columns go west to east</li>
<li>Negative y-resolution: rows go north to south (standard in GeoTIFF)</li>
</ul></li>
<li><strong>Nodata:</strong> 0 or 65535 (no valid data, masked areas)</li>
</ul>
<p><strong>Transform (Affine):</strong></p>
<pre><code>| x_pixel_size  0.0            x_origin |
| 0.0          -y_pixel_size   y_origin |
| 0.0           0.0            1.0      |</code></pre>
<p>Maps pixel coordinates (row, col) to real-world coordinates (x, y).</p>
</div>
</div>
<p><strong>Better pattern: Context manager (auto-closes file):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Context manager ensures file is closed even if error occurs</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Opened: </span><span class="sc">{</span>src<span class="sc">.</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># File automatically closed after 'with' block - prevents memory leaks!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="reading-raster-data-into-arrays" class="level3">
<h3 class="anchored" data-anchor-id="reading-raster-data-into-arrays">Reading Raster Data into Arrays</h3>
<p><strong>Read a single band:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read band 1 (Rasterio uses 1-indexing for bands!)</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    band1 <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store metadata for later use</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Band 1 shape: </span><span class="sc">{</span>band1<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (height, width)</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Data type: </span><span class="sc">{</span>band1<span class="sc">.</span>dtype<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Min value: </span><span class="sc">{</span>band1<span class="sc">.</span><span class="bu">min</span>()<span class="sc">}</span><span class="ss">, Max value: </span><span class="sc">{</span>band1<span class="sc">.</span><span class="bu">max</span>()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Mean value: </span><span class="sc">{</span>band1<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Mask nodata values</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> profile[<span class="st">'nodata'</span>] <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    band1_masked <span class="op">=</span> np.ma.masked_equal(band1, profile[<span class="st">'nodata'</span>])</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Mean (excluding nodata): </span><span class="sc">{</span>band1_masked<span class="sc">.</span>mean()<span class="sc">:.2f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Read multiple bands:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read all bands as 3D array (bands, height, width)</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    all_bands <span class="op">=</span> src.read()</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Or read specific bands</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>)   <span class="co"># Band 1: Blue (B2 for Sentinel-2)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># Band 2: Green (B3)</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># Band 3: Red (B4)</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>)    <span class="co"># Band 4: NIR (B8)</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"All bands shape: </span><span class="sc">{</span>all_bands<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (4, height, width)</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Individual band shape: </span><span class="sc">{</span>blue<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (height, width)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Windowed reading (memory-efficient for large files):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.windows <span class="im">import</span> Window</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read a 1000x1000 pixel window starting at row 500, col 500</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>    window <span class="op">=</span> Window(col_off<span class="op">=</span><span class="dv">500</span>, row_off<span class="op">=</span><span class="dv">500</span>, width<span class="op">=</span><span class="dv">1000</span>, height<span class="op">=</span><span class="dv">1000</span>)</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>    subset <span class="op">=</span> src.read(<span class="dv">1</span>, window<span class="op">=</span>window)</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Subset shape: </span><span class="sc">{</span>subset<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)  <span class="co"># (1000, 1000)</span></span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Memory saved by reading only needed area!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="calculating-spectral-indices" class="level3">
<h3 class="anchored" data-anchor-id="calculating-spectral-indices">Calculating Spectral Indices</h3>
<p>Spectral indices combine bands to highlight specific features. Let’s implement the most common indices.</p>
<section id="ndvi-normalized-difference-vegetation-index" class="level4">
<h4 class="anchored" data-anchor-id="ndvi-normalized-difference-vegetation-index">NDVI (Normalized Difference Vegetation Index)</h4>
<p><strong>Formula:</strong> NDVI = (NIR - Red) / (NIR + Red)</p>
<p><strong>For Sentinel-2:</strong> NDVI = (B8 - B4) / (B8 + B4)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read bands as float to avoid integer overflow</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>).astype(<span class="bu">float</span>)   <span class="co"># B4</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)   <span class="co"># B8</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Store metadata for saving later</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDVI</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add small value to prevent division by zero</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI range: </span><span class="sc">{</span>ndvi<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss"> to </span><span class="sc">{</span>ndvi<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"NDVI mean: </span><span class="sc">{</span>ndvi<span class="sc">.</span>mean()<span class="sc">:.3f}</span><span class="ss">"</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize NDVI</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'NDVI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"NDVI - Vegetation Index"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Column (pixels)"</span>)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Row (pixels)"</span>)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>NDVI interpretation:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>NDVI Range</th>
<th>Surface Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>&lt; 0</strong></td>
<td>Water, clouds, snow</td>
</tr>
<tr class="even">
<td><strong>0 - 0.2</strong></td>
<td>Bare soil, rock, sand, urban areas</td>
</tr>
<tr class="odd">
<td><strong>0.2 - 0.4</strong></td>
<td>Sparse vegetation, grassland, shrubland</td>
</tr>
<tr class="even">
<td><strong>0.4 - 0.7</strong></td>
<td>Moderate vegetation, cropland, forest</td>
</tr>
<tr class="odd">
<td><strong>&gt; 0.7</strong></td>
<td>Dense vegetation, healthy forest, mature crops</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="philippine-application-rice-paddy-monitoring" class="level3 philippine-context">
<h3 class="anchored" data-anchor-id="philippine-application-rice-paddy-monitoring">Philippine Application: Rice Paddy Monitoring</h3>
<p>Rice paddies show characteristic NDVI patterns during growing season:</p>
<ul>
<li><strong>Flooding/transplanting:</strong> Low NDVI (0.1-0.3) - water and sparse seedlings</li>
<li><strong>Vegetative growth:</strong> Rising NDVI (0.4-0.6) - canopy development</li>
<li><strong>Peak growth:</strong> High NDVI (0.6-0.8) - maximum biomass</li>
<li><strong>Senescence/harvest:</strong> Declining NDVI (0.3-0.5) - yellowing and harvest</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify rice paddies (moderate-high NDVI during growing season)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>rice_mask <span class="op">=</span> (ndvi <span class="op">&gt;</span> <span class="fl">0.5</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;</span> <span class="fl">0.85</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>plt.imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Potential Rice Paddies (NDVI 0.5-0.85)"</span>)</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>plt.colorbar()</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>rice_pixels <span class="op">=</span> rice_mask.<span class="bu">sum</span>()</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>total_pixels <span class="op">=</span> rice_mask.size</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>pixel_area_m2 <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># 10m resolution</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>rice_area_ha <span class="op">=</span> (rice_pixels <span class="op">*</span> pixel_area_m2) <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># m² to hectares</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Potential rice paddies: </span><span class="sc">{</span>rice_pixels<span class="sc">:,}</span><span class="ss"> pixels (</span><span class="sc">{</span>rice_pixels<span class="op">/</span>total_pixels<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%)"</span>)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Estimated rice area: </span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Operational use:</strong> PRiSM uses similar SAR-based approaches for nationwide rice monitoring.</p>
</section>
<section id="evi-enhanced-vegetation-index" class="level4">
<h4 class="anchored" data-anchor-id="evi-enhanced-vegetation-index">EVI (Enhanced Vegetation Index)</h4>
<p><strong>Formula:</strong> EVI = 2.5 × ((NIR - Red) / (NIR + 6×Red - 7.5×Blue + 1))</p>
<p><strong>Advantages over NDVI:</strong> - Less saturated in dense vegetation - Better atmospheric correction - Reduces soil background effects</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>).astype(<span class="bu">float</span>)  <span class="co"># B2</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>).astype(<span class="bu">float</span>)   <span class="co"># B4</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)   <span class="co"># B8</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate EVI</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> <span class="fl">2.5</span> <span class="op">*</span> ((nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>red <span class="op">-</span> <span class="fl">7.5</span><span class="op">*</span>blue <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Typical EVI range is -1 to 1, but often 0 to 1 for vegetation</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> np.clip(evi, <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)  <span class="co"># Clip extreme values</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>plt.imshow(evi, cmap<span class="op">=</span><span class="st">'YlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'EVI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"EVI - Enhanced Vegetation Index"</span>)</span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"EVI range: </span><span class="sc">{</span>evi<span class="sc">.</span><span class="bu">min</span>()<span class="sc">:.3f}</span><span class="ss"> to </span><span class="sc">{</span>evi<span class="sc">.</span><span class="bu">max</span>()<span class="sc">:.3f}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="ndwi-normalized-difference-water-index" class="level4">
<h4 class="anchored" data-anchor-id="ndwi-normalized-difference-water-index">NDWI (Normalized Difference Water Index)</h4>
<p><strong>Formula:</strong> NDWI = (Green - NIR) / (Green + NIR)</p>
<p><strong>For Sentinel-2:</strong> NDWI = (B3 - B8) / (B3 + B8)</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>).astype(<span class="bu">float</span>)  <span class="co"># B3</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>).astype(<span class="bu">float</span>)    <span class="co"># B8</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDWI</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>ndwi <span class="op">=</span> (green <span class="op">-</span> nir) <span class="op">/</span> (green <span class="op">+</span> nir <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndwi, cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>plt.colorbar(label<span class="op">=</span><span class="st">'NDWI'</span>, shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"NDWI - Water Index"</span>)</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract water bodies (NDWI &gt; 0.3 typically indicates water)</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>water_mask <span class="op">=</span> ndwi <span class="op">&gt;</span> <span class="fl">0.3</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>water_pixels <span class="op">=</span> water_mask.<span class="bu">sum</span>()</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>water_area_ha <span class="op">=</span> (water_pixels <span class="op">*</span> <span class="dv">100</span>) <span class="op">/</span> <span class="dv">10000</span>  <span class="co"># 10m pixels, convert to hectares</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Water pixels: </span><span class="sc">{</span>water_pixels<span class="sc">:,}</span><span class="ss">"</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Water area: </span><span class="sc">{</span>water_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>NDWI interpretation:</strong> - <strong>&gt; 0.3:</strong> Open water (rivers, lakes, reservoirs) - <strong>0.0 - 0.3:</strong> Wet soil, flooded vegetation - <strong>&lt; 0:</strong> Dry soil, vegetation</p>
</section>
<section id="creating-rgb-and-false-color-composites" class="level3">
<h3 class="anchored" data-anchor-id="creating-rgb-and-false-color-composites">Creating RGB and False Color Composites</h3>
<section id="true-color-composite-red-green-blue" class="level4">
<h4 class="anchored" data-anchor-id="true-color-composite-red-green-blue">True Color Composite (Red, Green, Blue)</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># B4</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># B3</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>    blue <span class="op">=</span> src.read(<span class="dv">1</span>)   <span class="co"># B2</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack bands into RGB array (height, width, 3)</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>rgb <span class="op">=</span> np.stack([red, green, blue], axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Scale to 0-1 range for display</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Sentinel-2 L2A surface reflectance: 0-10000</span></span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>rgb_scaled <span class="op">=</span> rgb.astype(<span class="bu">float</span>) <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>rgb_scaled <span class="op">=</span> np.clip(rgb_scaled, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># Clip any values outside 0-1</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhance contrast using percentile stretch</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> scoreatpercentile</span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percentile_stretch(image, lower<span class="op">=</span><span class="dv">2</span>, upper<span class="op">=</span><span class="dv">98</span>):</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Stretch image values between percentiles for better visualization."""</span></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a>    out <span class="op">=</span> np.zeros_like(image, dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(image.shape[<span class="dv">2</span>]):</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a>        band <span class="op">=</span> image[:,:,i]</span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>        low, high <span class="op">=</span> scoreatpercentile(band, (lower, upper))</span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>        out[:,:,i] <span class="op">=</span> np.clip((band <span class="op">-</span> low) <span class="op">/</span> (high <span class="op">-</span> low), <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> out</span>
<span id="cb42-24"><a href="#cb42-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-25"><a href="#cb42-25" aria-hidden="true" tabindex="-1"></a>rgb_enhanced <span class="op">=</span> percentile_stretch(rgb_scaled, lower<span class="op">=</span><span class="dv">2</span>, upper<span class="op">=</span><span class="dv">98</span>)</span>
<span id="cb42-26"><a href="#cb42-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-27"><a href="#cb42-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Display</span></span>
<span id="cb42-28"><a href="#cb42-28" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">7</span>))</span>
<span id="cb42-29"><a href="#cb42-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-30"><a href="#cb42-30" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].imshow(rgb_scaled)</span>
<span id="cb42-31"><a href="#cb42-31" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].set_title(<span class="st">"True Color (Linear Stretch)"</span>)</span>
<span id="cb42-32"><a href="#cb42-32" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb42-33"><a href="#cb42-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-34"><a href="#cb42-34" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(rgb_enhanced)</span>
<span id="cb42-35"><a href="#cb42-35" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"True Color (Enhanced Contrast)"</span>)</span>
<span id="cb42-36"><a href="#cb42-36" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb42-37"><a href="#cb42-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-38"><a href="#cb42-38" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb42-39"><a href="#cb42-39" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="false-color-composite-nir-red-green" class="level4">
<h4 class="anchored" data-anchor-id="false-color-composite-nir-red-green">False Color Composite (NIR, Red, Green)</h4>
<p><strong>Purpose:</strong> Highlights vegetation (appears red) and makes it easier to distinguish land cover types.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    nir <span class="op">=</span> src.read(<span class="dv">4</span>)    <span class="co"># B8</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    red <span class="op">=</span> src.read(<span class="dv">3</span>)    <span class="co"># B4</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    green <span class="op">=</span> src.read(<span class="dv">2</span>)  <span class="co"># B3</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co"># NIR-R-G composite (standard false color)</span></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>false_color <span class="op">=</span> np.stack([nir, red, green], axis<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>false_color_scaled <span class="op">=</span> false_color.astype(<span class="bu">float</span>) <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>false_color_scaled <span class="op">=</span> np.clip(false_color_scaled, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply percentile stretch</span></span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>false_color_enhanced <span class="op">=</span> percentile_stretch(false_color_scaled)</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>plt.imshow(false_color_enhanced)</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"False Color Composite (NIR-Red-Green)</span><span class="ch">\n</span><span class="st">Vegetation appears red"</span>)</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>False color interpretation:</strong></p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Color</th>
<th>Surface Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Bright red</strong></td>
<td>Dense, healthy vegetation (high NIR)</td>
</tr>
<tr class="even">
<td><strong>Pink/magenta</strong></td>
<td>Moderate vegetation</td>
</tr>
<tr class="odd">
<td><strong>Dark blue/black</strong></td>
<td>Water (absorbs NIR)</td>
</tr>
<tr class="even">
<td><strong>Cyan/gray</strong></td>
<td>Urban areas, bare soil</td>
</tr>
<tr class="odd">
<td><strong>Brown/tan</strong></td>
<td>Sparse vegetation, agricultural fields</td>
</tr>
</tbody>
</table>
<p><strong>Why false color is useful:</strong> - Vegetation is much more distinguishable (red tones) - Water bodies are very dark (low NIR) - Urban areas are clearly visible (cyan/gray) - Useful for rapid visual interpretation before quantitative analysis</p>
</section>
</section>
<section id="saving-processed-rasters" class="level3">
<h3 class="anchored" data-anchor-id="saving-processed-rasters">Saving Processed Rasters</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save NDVI as GeoTIFF</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>output_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/ndvi.tif'</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Update profile for single-band float output</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>profile.update(</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span>rasterio.float32,</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    count<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    compress<span class="op">=</span><span class="st">'lzw'</span>,  <span class="co"># Compress to save space</span></span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=-</span><span class="dv">9999</span>     <span class="co"># Define nodata value</span></span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(output_path, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    dst.write(ndvi.astype(rasterio.float32), <span class="dv">1</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Saved NDVI to: </span><span class="sc">{</span>output_path<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-7-combining-vector-and-raster-operations" class="level2">
<h2 class="anchored" data-anchor-id="part-7-combining-vector-and-raster-operations">Part 7: Combining Vector and Raster Operations</h2>
<p>Real-world EO workflows often require integrating vector and raster data. Let’s explore common operations.</p>
<section id="clipping-raster-to-vector-boundary" class="level3">
<h3 class="anchored" data-anchor-id="clipping-raster-to-vector-boundary">Clipping Raster to Vector Boundary</h3>
<p><strong>Use case:</strong> Extract satellite data only within your area of interest (e.g., a province, protected area, or farm boundary).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Load AOI polygon (from earlier GeoPandas section)</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># aoi_gdf = gpd.read_file('my_aoi.geojson')</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure CRS match - CRITICAL for accurate clipping!</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> aoi_gdf.crs <span class="op">!=</span> src.crs:</span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Reprojecting AOI from </span><span class="sc">{</span>aoi_gdf<span class="sc">.</span>crs<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>        aoi_gdf <span class="op">=</span> aoi_gdf.to_crs(src.crs)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get geometries in proper format (list of shapely geometries)</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>    shapes <span class="op">=</span> aoi_gdf.geometry.values</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip raster to vector boundary</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a>    out_image, out_transform <span class="op">=</span> mask(src, shapes, crop<span class="op">=</span><span class="va">True</span>, nodata<span class="op">=</span>src.nodata)</span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>    out_meta <span class="op">=</span> src.meta.copy()</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Update metadata for clipped raster</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a>out_meta.update({</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"driver"</span>: <span class="st">"GTiff"</span>,</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"height"</span>: out_image.shape[<span class="dv">1</span>],</span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"width"</span>: out_image.shape[<span class="dv">2</span>],</span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"transform"</span>: out_transform</span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Original raster: </span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Clipped raster: </span><span class="sc">{</span>out_meta[<span class="st">'width'</span>]<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>out_meta[<span class="st">'height'</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Size reduction: </span><span class="sc">{</span>(<span class="dv">1</span> <span class="op">-</span> (out_meta[<span class="st">'width'</span>]<span class="op">*</span>out_meta[<span class="st">'height'</span>])<span class="op">/</span>(src.width<span class="op">*</span>src.height))<span class="op">*</span><span class="dv">100</span><span class="sc">:.1f}</span><span class="ss">%"</span>)</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize clipped area</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Original</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].imshow(src.read(<span class="dv">3</span>), cmap<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a>    axes[<span class="dv">0</span>].set_title(<span class="st">"Original Raster (Full Extent)"</span>)</span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Clipped</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].imshow(out_image[<span class="dv">2</span>], cmap<span class="op">=</span><span class="st">'gray'</span>)  <span class="co"># Band 3 (Red channel)</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>].set_title(<span class="st">"Clipped to AOI"</span>)</span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Save clipped raster:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>clipped_path <span class="op">=</span> <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/clipped_raster.tif'</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(clipped_path, <span class="st">'w'</span>, <span class="op">**</span>out_meta) <span class="im">as</span> dest:</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    dest.write(out_image)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Saved clipped raster to: </span><span class="sc">{</span>clipped_path<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"File size reduced for faster processing and storage!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>When to Clip Rasters
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Advantages:</strong> - <strong>Reduced file size:</strong> Smaller files load and process faster - <strong>Focused analysis:</strong> Only relevant area is analyzed - <strong>Lower memory use:</strong> Important for large Sentinel-2 tiles (100 km² at 10m = 100 million pixels!) - <strong>Easier visualization:</strong> Zoomed to area of interest</p>
<p><strong>Best practice:</strong> Clip rasters early in your workflow to avoid processing unnecessary pixels.</p>
</div>
</div>
</section>
<section id="sampling-raster-values-at-point-locations" class="level3">
<h3 class="anchored" data-anchor-id="sampling-raster-values-at-point-locations">Sampling Raster Values at Point Locations</h3>
<p><strong>Use case:</strong> Extract satellite data at field survey locations for validation or model training.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Field survey locations (GPS coordinates)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>survey_points <span class="op">=</span> gpd.GeoDataFrame({</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'site_id'</span>: [<span class="st">'Site_A'</span>, <span class="st">'Site_B'</span>, <span class="st">'Site_C'</span>],</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'land_cover'</span>: [<span class="st">'Forest'</span>, <span class="st">'Cropland'</span>, <span class="st">'Urban'</span>],</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'geometry'</span>: gpd.points_from_xy(</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">124.0</span>, <span class="fl">124.5</span>, <span class="fl">123.8</span>],  <span class="co"># Longitudes</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>        [<span class="fl">10.0</span>, <span class="fl">10.3</span>, <span class="fl">9.8</span>]       <span class="co"># Latitudes</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>}, crs<span class="op">=</span><span class="st">'EPSG:4326'</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample raster at points</span></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reproject points if needed</span></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> survey_points.crs <span class="op">!=</span> src.crs:</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>        survey_points <span class="op">=</span> survey_points.to_crs(src.crs)</span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extract coordinates as (x, y) tuples</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>    coords <span class="op">=</span> [(x, y) <span class="cf">for</span> x, y <span class="kw">in</span> <span class="bu">zip</span>(survey_points.geometry.x, survey_points.geometry.y)]</span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sample all bands at each point</span></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>    sampled_values <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> src.sample(coords)]</span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Add sampled values to GeoDataFrame</span></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'blue'</span>] <span class="op">=</span> [v[<span class="dv">0</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'green'</span>] <span class="op">=</span> [v[<span class="dv">1</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'red'</span>] <span class="op">=</span> [v[<span class="dv">2</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'nir'</span>] <span class="op">=</span> [v[<span class="dv">3</span>] <span class="cf">for</span> v <span class="kw">in</span> sampled_values]</span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate NDVI at points</span></span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a>survey_points[<span class="st">'ndvi'</span>] <span class="op">=</span> (survey_points[<span class="st">'nir'</span>] <span class="op">-</span> survey_points[<span class="st">'red'</span>]) <span class="op">/</span> <span class="op">\</span></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a>                        (survey_points[<span class="st">'nir'</span>] <span class="op">+</span> survey_points[<span class="st">'red'</span>] <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb47-32"><a href="#cb47-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-33"><a href="#cb47-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert DN to reflectance (Sentinel-2 scaling)</span></span>
<span id="cb47-34"><a href="#cb47-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> band <span class="kw">in</span> [<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'nir'</span>]:</span>
<span id="cb47-35"><a href="#cb47-35" aria-hidden="true" tabindex="-1"></a>    survey_points[<span class="ss">f'</span><span class="sc">{</span>band<span class="sc">}</span><span class="ss">_refl'</span>] <span class="op">=</span> survey_points[band] <span class="op">/</span> <span class="fl">10000.0</span></span>
<span id="cb47-36"><a href="#cb47-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-37"><a href="#cb47-37" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Sampled Values at Survey Points:"</span>)</span>
<span id="cb47-38"><a href="#cb47-38" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(survey_points[[<span class="st">'site_id'</span>, <span class="st">'land_cover'</span>, <span class="st">'ndvi'</span>]])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Export results for validation:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Save as CSV for Excel/analysis</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>survey_points.drop(<span class="st">'geometry'</span>, axis<span class="op">=</span><span class="dv">1</span>).to_csv(</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/field_validation.csv'</span>,</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="va">False</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Or save as shapefile with geometry</span></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>survey_points.to_file(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'/content/drive/MyDrive/CoPhil_Training/outputs/field_validation.shp'</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Validation data exported!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="zonal-statistics" class="level3">
<h3 class="anchored" data-anchor-id="zonal-statistics">Zonal Statistics</h3>
<p><strong>Use case:</strong> Calculate average NDVI (or other metrics) for each administrative unit, farm, or land parcel.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Calculate mean NDVI per municipality</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Requires rasterstats library</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>pip install rasterstats <span class="op">-</span>q</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterstats <span class="im">import</span> zonal_stats</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Load municipality boundaries</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>municipalities <span class="op">=</span> gpd.read_file(<span class="st">'municipalities.shp'</span>)</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate zonal statistics</span></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>stats <span class="op">=</span> zonal_stats(</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>    municipalities,</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>    ndvi,</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>    affine<span class="op">=</span>profile[<span class="st">'transform'</span>],</span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>    stats<span class="op">=</span>[<span class="st">'min'</span>, <span class="st">'max'</span>, <span class="st">'mean'</span>, <span class="st">'std'</span>, <span class="st">'count'</span>],</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a>    nodata<span class="op">=-</span><span class="dv">9999</span></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Add statistics to GeoDataFrame</span></span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>municipalities[<span class="st">'ndvi_mean'</span>] <span class="op">=</span> [s[<span class="st">'mean'</span>] <span class="cf">for</span> s <span class="kw">in</span> stats]</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>municipalities[<span class="st">'ndvi_std'</span>] <span class="op">=</span> [s[<span class="st">'std'</span>] <span class="cf">for</span> s <span class="kw">in</span> stats]</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize municipalities by mean NDVI</span></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">10</span>))</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a>municipalities.plot(</span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>    column<span class="op">=</span><span class="st">'ndvi_mean'</span>,</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">'YlGn'</span>,</span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a>    legend<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a>    ax<span class="op">=</span>ax,</span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>    edgecolor<span class="op">=</span><span class="st">'black'</span>,</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Mean NDVI by Municipality"</span>)</span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(municipalities[[<span class="st">'NAME'</span>, <span class="st">'ndvi_mean'</span>, <span class="st">'ndvi_std'</span>]].head())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-8-preprocessing-workflows-for-machine-learning" class="level2">
<h2 class="anchored" data-anchor-id="part-8-preprocessing-workflows-for-machine-learning">Part 8: Preprocessing Workflows for Machine Learning</h2>
<p>Now let’s connect everything to prepare <strong>analysis-ready data for ML</strong> (Sessions 5-7).</p>
<section id="workflow-1-preparing-training-samples-for-classification" class="level3">
<h3 class="anchored" data-anchor-id="workflow-1-preparing-training-samples-for-classification">Workflow 1: Preparing Training Samples for Classification</h3>
<p><strong>Goal:</strong> Create a dataset of labeled pixels for land cover classification.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Load training polygons (digitized by expert)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>training_polygons <span class="op">=</span> gpd.read_file(<span class="st">'training_areas.shp'</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Columns: 'class_id', 'class_name', 'geometry'</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Rasterize polygons to match satellite image grid</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create empty array</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>    training_mask <span class="op">=</span> rasterize(</span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>        [(geom, value) <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(training_polygons.geometry, training_polygons[<span class="st">'class_id'</span>])],</span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>        out_shape<span class="op">=</span>(src.height, src.width),</span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>src.transform,</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>        fill<span class="op">=</span><span class="dv">0</span>,  <span class="co"># Background class</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>        dtype<span class="op">=</span><span class="st">'uint8'</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Extract pixel values at training locations</span></span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    bands <span class="op">=</span> src.read()  <span class="co"># (n_bands, height, width)</span></span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Reshape to (n_pixels, n_bands)</span></span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>n_bands, height, width <span class="op">=</span> bands.shape</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>pixels <span class="op">=</span> bands.reshape(n_bands, <span class="op">-</span><span class="dv">1</span>).T  <span class="co"># (n_pixels, n_bands)</span></span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> training_mask.flatten()       <span class="co"># (n_pixels,)</span></span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to labeled pixels only (exclude background class 0)</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>labeled_mask <span class="op">=</span> labels <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> pixels[labeled_mask]  <span class="co"># Features</span></span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> labels[labeled_mask]  <span class="co"># Labels</span></span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Training samples: </span><span class="sc">{</span>X<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">:,}</span><span class="ss"> pixels"</span>)</span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features: </span><span class="sc">{</span>X<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> bands"</span>)</span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>np<span class="sc">.</span>unique(y)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb50-35"><a href="#cb50-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-36"><a href="#cb50-36" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Normalize features (important for ML!)</span></span>
<span id="cb50-37"><a href="#cb50-37" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb50-38"><a href="#cb50-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-39"><a href="#cb50-39" aria-hidden="true" tabindex="-1"></a>scaler <span class="op">=</span> StandardScaler()</span>
<span id="cb50-40"><a href="#cb50-40" aria-hidden="true" tabindex="-1"></a>X_scaled <span class="op">=</span> scaler.fit_transform(X)</span>
<span id="cb50-41"><a href="#cb50-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-42"><a href="#cb50-42" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Data ready for ML model training!"</span>)</span>
<span id="cb50-43"><a href="#cb50-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Next steps: Split into train/val/test, train Random Forest or CNN"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="workflow-2-creating-multi-temporal-stack" class="level3">
<h3 class="anchored" data-anchor-id="workflow-2-creating-multi-temporal-stack">Workflow 2: Creating Multi-Temporal Stack</h3>
<p><strong>Goal:</strong> Combine images from different dates to capture phenology (crop growth cycles, seasonal changes).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List of raster paths from different dates</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>date_paths <span class="op">=</span> [</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_01_15.tif'</span>,  <span class="co"># Dry season</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_04_15.tif'</span>,  <span class="co"># Transition</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_07_15.tif'</span>,  <span class="co"># Wet season</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'sentinel2_2024_10_15.tif'</span>   <span class="co"># Harvest</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Read all dates and stack</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>stacked_bands <span class="op">=</span> []</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>dates <span class="op">=</span> []</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> path <span class="kw">in</span> date_paths:</span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(path) <span class="im">as</span> src:</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>        stacked_bands.append(src.read())  <span class="co"># (n_bands, height, width)</span></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>        dates.append(path.split(<span class="st">'_'</span>)[<span class="dv">1</span>])  <span class="co"># Extract date from filename</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> src.profile.copy()  <span class="co"># Use last profile as template</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack along band dimension: (n_dates * n_bands, height, width)</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>multi_temporal <span class="op">=</span> np.concatenate(stacked_bands, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Multi-temporal stack shape: </span><span class="sc">{</span>multi_temporal<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Total bands: </span><span class="sc">{</span>multi_temporal<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> (4 dates × </span><span class="sc">{</span>stacked_bands[<span class="dv">0</span>]<span class="sc">.</span>shape[<span class="dv">0</span>]<span class="sc">}</span><span class="ss"> bands)"</span>)</span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Dates: </span><span class="sc">{</span>dates<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Save multi-temporal stack</span></span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>profile.update(count<span class="op">=</span>multi_temporal.shape[<span class="dv">0</span>])</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'multi_temporal_stack.tif'</span>, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>    dst.write(multi_temporal)</span>
<span id="cb51-31"><a href="#cb51-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-32"><a href="#cb51-32" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"✓ Multi-temporal stack created!"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Why multi-temporal?</strong> - <strong>Better classification:</strong> Captures seasonal patterns (e.g., crops have distinct phenology) - <strong>Change detection:</strong> Compare dates to detect deforestation, urban growth, flooding - <strong>Improved accuracy:</strong> Machine learning models benefit from temporal features - <strong>PRiSM approach:</strong> Uses SAR time series to detect rice planting/harvesting</p>
</section>
<section id="workflow-3-resampling-and-reprojection" class="level3">
<h3 class="anchored" data-anchor-id="workflow-3-resampling-and-reprojection">Workflow 3: Resampling and Reprojection</h3>
<p><strong>Goal:</strong> Make rasters from different sensors compatible (same resolution, CRS, extent).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.warp <span class="im">import</span> reproject, Resampling</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Resample 20m Sentinel-2 bands to 10m</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'sentinel2_B11_20m.tif'</span>) <span class="im">as</span> src:</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Define target resolution</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    scale_factor <span class="op">=</span> <span class="dv">2</span>  <span class="co"># 20m → 10m</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate new dimensions</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    new_height <span class="op">=</span> src.height <span class="op">*</span> scale_factor</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    new_width <span class="op">=</span> src.width <span class="op">*</span> scale_factor</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update transform</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    new_transform <span class="op">=</span> src.transform <span class="op">*</span> src.transform.scale(</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        (src.width <span class="op">/</span> new_width),</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        (src.height <span class="op">/</span> new_height)</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create output array</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>    upsampled <span class="op">=</span> np.empty((src.count, new_height, new_width), dtype<span class="op">=</span>src.dtypes[<span class="dv">0</span>])</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Reproject</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>    reproject(</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        source<span class="op">=</span>rasterio.band(src, <span class="dv">1</span>),</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>        destination<span class="op">=</span>upsampled[<span class="dv">0</span>],</span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        src_transform<span class="op">=</span>src.transform,</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        src_crs<span class="op">=</span>src.crs,</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        dst_transform<span class="op">=</span>new_transform,</span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        dst_crs<span class="op">=</span>src.crs,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        resampling<span class="op">=</span>Resampling.bilinear  <span class="co"># or cubic, nearest</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update profile</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>    profile.update(</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>        width<span class="op">=</span>new_width,</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>        height<span class="op">=</span>new_height,</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>        transform<span class="op">=</span>new_transform</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Save resampled raster</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(<span class="st">'sentinel2_B11_10m.tif'</span>, <span class="st">'w'</span>, <span class="op">**</span>profile) <span class="im">as</span> dst:</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>    dst.write(upsampled)</span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"✓ Resampled from </span><span class="sc">{</span>src<span class="sc">.</span>height<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>src<span class="sc">.</span>width<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>new_height<span class="sc">}</span><span class="ss">x</span><span class="sc">{</span>new_width<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Resampling methods:</strong> - <strong>Nearest:</strong> Fast, preserves values (good for classification maps) - <strong>Bilinear:</strong> Smooth, averages neighbors (good for continuous data) - <strong>Cubic:</strong> Smoothest, best for visualization (slower)</p>
</section>
<section id="workflow-4-data-augmentation-for-deep-learning" class="level3">
<h3 class="anchored" data-anchor-id="workflow-4-data-augmentation-for-deep-learning">Workflow 4: Data Augmentation for Deep Learning</h3>
<p><strong>Goal:</strong> Artificially increase training data diversity to prevent overfitting.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example: Augment image chips for CNN training</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> cv2</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> augment_chip(image, label<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Apply random augmentations to image chip.</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">    image : ndarray (H, W, C)</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">        Image chip</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">    label : ndarray (H, W), optional</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="co">        Corresponding label mask</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a><span class="co">    augmented_image, augmented_label (if label provided)</span></span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random rotation (0, 90, 180, 270 degrees)</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    k <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="dv">4</span>)</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    image <span class="op">=</span> np.rot90(image, k)</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> np.rot90(label, k)</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random flip (horizontal and/or vertical)</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.fliplr(image)</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> np.fliplr(label)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.flipud(image)</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>            label <span class="op">=</span> np.flipud(label)</span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Random brightness adjustment (simulate atmospheric variations)</span></span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.random.rand() <span class="op">&gt;</span> <span class="fl">0.5</span>:</span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a>        factor <span class="op">=</span> np.random.uniform(<span class="fl">0.8</span>, <span class="fl">1.2</span>)</span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>        image <span class="op">=</span> np.clip(image <span class="op">*</span> factor, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> label <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> image, label</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> image</span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Example usage</span></span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a><span class="co"># chip = rgb_chip  # (256, 256, 3)</span></span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a><span class="co"># label_chip = land_cover_chip  # (256, 256)</span></span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a><span class="co"># aug_chip, aug_label = augment_chip(chip, label_chip)</span></span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Data augmentation functions ready!"</span>)</span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Use during training to increase dataset size 4-8x without new data collection"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-9-best-practices-and-common-pitfalls" class="level2">
<h2 class="anchored" data-anchor-id="part-9-best-practices-and-common-pitfalls">Part 9: Best Practices and Common Pitfalls</h2>
<section id="memory-management-for-large-rasters" class="level3">
<h3 class="anchored" data-anchor-id="memory-management-for-large-rasters">Memory Management for Large Rasters</h3>
<p><strong>Problem:</strong> Sentinel-2 tiles are huge (100km² at 10m = 100 million pixels × 4 bands = 400 MB per tile).</p>
<p><strong>Solutions:</strong></p>
<p><strong>1. Windowed Reading:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Process in chunks instead of loading entire raster</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(large_raster) <span class="im">as</span> src:</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> window <span class="kw">in</span> src.block_windows():</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> src.read(window<span class="op">=</span>window)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Process chunk</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> process_data(data)</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Write chunk to output</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>2. Downsampling:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read at lower resolution for exploratory analysis</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Read every 10th pixel</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> src.read(out_shape<span class="op">=</span>(src.count, src.height <span class="op">//</span> <span class="dv">10</span>, src.width <span class="op">//</span> <span class="dv">10</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>3. Cloud-Optimized GeoTIFF (COG):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to COG for efficient cloud access</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>gdal_translate <span class="bu">input</span>.tif output_cog.tif <span class="op">-</span>of COG <span class="op">-</span>co COMPRESS<span class="op">=</span>DEFLATE</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="vectorization-vs.-loops" class="level3">
<h3 class="anchored" data-anchor-id="vectorization-vs.-loops">Vectorization vs.&nbsp;Loops</h3>
<p><strong>Slow (loop over pixels):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DON'T DO THIS</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(height):</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(width):</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>        ndvi[i, j] <span class="op">=</span> (nir[i, j] <span class="op">-</span> red[i, j]) <span class="op">/</span> (nir[i, j] <span class="op">+</span> red[i, j])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Fast (vectorized with NumPy):</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DO THIS</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)  <span class="co"># Single operation on entire array</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Why?</strong> NumPy operations are implemented in C and optimized for array operations. Can be <strong>100-1000x faster</strong> than Python loops!</p>
</section>
<section id="error-handling-for-geospatial-operations" class="level3">
<h3 class="anchored" data-anchor-id="error-handling-for-geospatial-operations">Error Handling for Geospatial Operations</h3>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> warnings</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Suppress common warnings that are usually harmless</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>warnings.filterwarnings(<span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">RuntimeWarning</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe division with error handling</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_divide(numerator, denominator):</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely divide arrays, handling division by zero."""</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> np.errstate(divide<span class="op">=</span><span class="st">'ignore'</span>, invalid<span class="op">=</span><span class="st">'ignore'</span>):</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>        result <span class="op">=</span> numerator <span class="op">/</span> denominator</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>        result[<span class="op">~</span>np.isfinite(result)] <span class="op">=</span> np.nan  <span class="co"># Replace inf/nan with nan</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Safe CRS transformation</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> safe_reproject(gdf, target_crs):</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Safely reproject GeoDataFrame with error handling."""</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gdf.to_crs(target_crs)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Warning: Reprojection failed: </span><span class="sc">{</span>e<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">"Returning original GeoDataFrame"</span>)</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> gdf</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="troubleshooting-common-issues" class="level3">
<h3 class="anchored" data-anchor-id="troubleshooting-common-issues">Troubleshooting Common Issues</h3>
<p><strong>Issue 1: CRS Mismatch</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: "CRS mismatch" error when overlaying vector and raster</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution: Check and align CRS</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    raster_crs <span class="op">=</span> src.crs</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> gdf.crs <span class="op">!=</span> raster_crs:</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Reprojecting vector from </span><span class="sc">{</span>gdf<span class="sc">.</span>crs<span class="sc">}</span><span class="ss"> to </span><span class="sc">{</span>raster_crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    gdf <span class="op">=</span> gdf.to_crs(raster_crs)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Issue 2: NoData Handling</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: Nodata values (0, -9999) skew statistics</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution: Mask nodata before calculations</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy.ma <span class="im">as</span> ma</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create masked array</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>raster_masked <span class="op">=</span> ma.masked_equal(raster, nodata_value)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics now ignore nodata</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> raster_masked.mean()</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>std <span class="op">=</span> raster_masked.std()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Issue 3: Memory Error</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Problem: MemoryError when loading large raster</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 1: Use windowed reading (shown above)</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 2: Work with lower resolution</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Solution 3: Use Dask for out-of-core computation</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> dask.array <span class="im">as</span> da</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rioxarray</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Open with rioxarray (uses Dask for lazy loading)</span></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>raster_da <span class="op">=</span> rioxarray.open_rasterio(raster_path, chunks<span class="op">=</span><span class="st">'auto'</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> (raster_da[<span class="dv">3</span>] <span class="op">-</span> raster_da[<span class="dv">2</span>]) <span class="op">/</span> (raster_da[<span class="dv">3</span>] <span class="op">+</span> raster_da[<span class="dv">2</span>])</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Computation happens only when .compute() is called</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="code-organization-for-reproducibility" class="level3">
<h3 class="anchored" data-anchor-id="code-organization-for-reproducibility">Code Organization for Reproducibility</h3>
<p><strong>Good practices:</strong></p>
<ol type="1">
<li><strong>Clear imports at top:</strong></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard library</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Third party</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Project-specific</span></span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> utils <span class="im">import</span> safe_divide, calculate_ndvi</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="2" type="1">
<li><strong>Define paths clearly:</strong></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define all paths at the beginning</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> Path(<span class="st">'/content/drive/MyDrive/CoPhil_Training'</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>DATA_DIR <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data'</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>RASTER_DIR <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">'raster'</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>VECTOR_DIR <span class="op">=</span> DATA_DIR <span class="op">/</span> <span class="st">'vector'</span></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'outputs'</span></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create output directory if it doesn't exist</span></span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>OUTPUT_DIR.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="3" type="1">
<li><strong>Use functions:</strong></li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess_sentinel2(raster_path, aoi_gdf<span class="op">=</span><span class="va">None</span>, scale_factor<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Load and preprocess Sentinel-2 imagery.</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Parameters:</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a><span class="co">    raster_path : str</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Path to Sentinel-2 GeoTIFF</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="co">    aoi_gdf : GeoDataFrame, optional</span></span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Area of interest for clipping</span></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">    scale_factor : int</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Scaling factor for reflectance conversion</span></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Returns:</span></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a><span class="co">    --------</span></span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="co">    bands : dict</span></span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a><span class="co">        Dictionary of band arrays</span></span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="co">    profile : dict</span></span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a><span class="co">        Raster metadata</span></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(raster_path) <span class="im">as</span> src:</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> aoi_gdf <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Clip to AOI</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a>            <span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>            bands_array, transform <span class="op">=</span> mask(src, aoi_gdf.geometry, crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>            bands_array <span class="op">=</span> src.read()</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>            transform <span class="op">=</span> src.transform</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a>        profile <span class="op">=</span> src.profile.copy()</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>        profile.update(transform<span class="op">=</span>transform)</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to reflectance</span></span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>    bands <span class="op">=</span> {</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a>        <span class="st">'blue'</span>: bands_array[<span class="dv">0</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a>        <span class="st">'green'</span>: bands_array[<span class="dv">1</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a>        <span class="st">'red'</span>: bands_array[<span class="dv">2</span>] <span class="op">/</span> scale_factor,</span>
<span id="cb65-38"><a href="#cb65-38" aria-hidden="true" tabindex="-1"></a>        <span class="st">'nir'</span>: bands_array[<span class="dv">3</span>] <span class="op">/</span> scale_factor</span>
<span id="cb65-39"><a href="#cb65-39" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb65-40"><a href="#cb65-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-41"><a href="#cb65-41" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> bands, profile</span>
<span id="cb65-42"><a href="#cb65-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-43"><a href="#cb65-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Usage</span></span>
<span id="cb65-44"><a href="#cb65-44" aria-hidden="true" tabindex="-1"></a>bands, profile <span class="op">=</span> preprocess_sentinel2(raster_path, aoi_gdf)</span>
<span id="cb65-45"><a href="#cb65-45" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> calculate_ndvi(bands[<span class="st">'nir'</span>], bands[<span class="st">'red'</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="part-10-complete-workflow-example" class="level2">
<h2 class="anchored" data-anchor-id="part-10-complete-workflow-example">Part 10: Complete Workflow Example</h2>
<p>Let’s put everything together in a realistic scenario.</p>
<section id="scenario-agricultural-monitoring-for-palawan-rice-area" class="level3">
<h3 class="anchored" data-anchor-id="scenario-agricultural-monitoring-for-palawan-rice-area">Scenario: Agricultural Monitoring for Palawan Rice Area</h3>
<p><strong>Goal:</strong> Map rice cultivation areas in Palawan using Sentinel-2 and prepare training data for ML classification.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.mask <span class="im">import</span> mask</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. SETUP</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Define paths</span></span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>BASE_DIR <span class="op">=</span> Path(<span class="st">'/content/drive/MyDrive/CoPhil_Training'</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>palawan_boundary <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/vector/palawan_province.shp'</span></span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>sentinel2_tile <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/raster/sentinel2_palawan_20240615.tif'</span></span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>training_areas <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'data/vector/rice_training_polygons.shp'</span></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>output_dir <span class="op">=</span> BASE_DIR <span class="op">/</span> <span class="st">'outputs/palawan_rice_analysis'</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>output_dir.mkdir(parents<span class="op">=</span><span class="va">True</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 1: Setup complete ✓"</span>)</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. LOAD AND INSPECT DATA</span></span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Load Palawan boundary</span></span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>palawan <span class="op">=</span> gpd.read_file(palawan_boundary)</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded Palawan boundary: </span><span class="sc">{</span>palawan<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Load training areas</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a>training <span class="op">=</span> gpd.read_file(training_areas)</span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Loaded training areas: </span><span class="sc">{</span><span class="bu">len</span>(training)<span class="sc">}</span><span class="ss"> polygons"</span>)</span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>training[<span class="st">'class_name'</span>]<span class="sc">.</span>unique()<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect Sentinel-2 metadata</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(sentinel2_tile) <span class="im">as</span> src:</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Sentinel-2 metadata:"</span>)</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Resolution: </span><span class="sc">{</span>src<span class="sc">.</span>res[<span class="dv">0</span>]<span class="sc">}</span><span class="ss">m"</span>)</span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  CRS: </span><span class="sc">{</span>src<span class="sc">.</span>crs<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bounds: </span><span class="sc">{</span>src<span class="sc">.</span>bounds<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"  Bands: </span><span class="sc">{</span>src<span class="sc">.</span>count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 2: Data loaded ✓"</span>)</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. CLIP RASTER TO PALAWAN</span></span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(sentinel2_tile) <span class="im">as</span> src:</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure CRS match</span></span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> palawan.crs <span class="op">!=</span> src.crs:</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>        palawan <span class="op">=</span> palawan.to_crs(src.crs)</span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clip to Palawan boundary</span></span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>    clipped, transform <span class="op">=</span> mask(src, palawan.geometry, crop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Update metadata</span></span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>    out_meta <span class="op">=</span> src.meta.copy()</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a>    out_meta.update({</span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>        <span class="st">"height"</span>: clipped.shape[<span class="dv">1</span>],</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a>        <span class="st">"width"</span>: clipped.shape[<span class="dv">2</span>],</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>        <span class="st">"transform"</span>: transform</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a><span class="co"># Save clipped raster</span></span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a>clipped_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="st">'palawan_sentinel2_clipped.tif'</span></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(clipped_path, <span class="st">'w'</span>, <span class="op">**</span>out_meta) <span class="im">as</span> dst:</span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>    dst.write(clipped)</span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Step 3: Clipped raster to Palawan ✓"</span>)</span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Size: </span><span class="sc">{</span>clipped<span class="sc">.</span>shape[<span class="dv">2</span>]<span class="sc">}</span><span class="ss"> x </span><span class="sc">{</span>clipped<span class="sc">.</span>shape[<span class="dv">1</span>]<span class="sc">}</span><span class="ss"> pixels"</span>)</span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. CALCULATE SPECTRAL INDICES</span></span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract bands</span></span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>blue <span class="op">=</span> clipped[<span class="dv">0</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a>green <span class="op">=</span> clipped[<span class="dv">1</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>red <span class="op">=</span> clipped[<span class="dv">2</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a>nir <span class="op">=</span> clipped[<span class="dv">3</span>].astype(<span class="bu">float</span>)</span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate indices</span></span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ndvi(nir, red):</span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> red <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_evi(nir, red, blue):</span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="fl">2.5</span> <span class="op">*</span> ((nir <span class="op">-</span> red) <span class="op">/</span> (nir <span class="op">+</span> <span class="dv">6</span><span class="op">*</span>red <span class="op">-</span> <span class="fl">7.5</span><span class="op">*</span>blue <span class="op">+</span> <span class="dv">1</span>))</span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calc_ndwi(green, nir):</span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (green <span class="op">-</span> nir) <span class="op">/</span> (green <span class="op">+</span> nir <span class="op">+</span> <span class="fl">1e-10</span>)</span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a>ndvi <span class="op">=</span> calc_ndvi(nir, red)</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a>evi <span class="op">=</span> calc_evi(nir, red, blue)</span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a>ndwi <span class="op">=</span> calc_ndwi(green, nir)</span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Step 4: Calculated spectral indices ✓"</span>)</span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a><span class="co"># Save indices</span></span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, data <span class="kw">in</span> [(<span class="st">'ndvi'</span>, ndvi), (<span class="st">'evi'</span>, evi), (<span class="st">'ndwi'</span>, ndwi)]:</span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a>    index_meta <span class="op">=</span> out_meta.copy()</span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a>    index_meta.update(dtype<span class="op">=</span>rasterio.float32, count<span class="op">=</span><span class="dv">1</span>, nodata<span class="op">=-</span><span class="dv">9999</span>)</span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a>    index_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="ss">f'palawan_</span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">.tif'</span></span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> rasterio.<span class="bu">open</span>(index_path, <span class="st">'w'</span>, <span class="op">**</span>index_meta) <span class="im">as</span> dst:</span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>        dst.write(data.astype(rasterio.float32), <span class="dv">1</span>)</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. IDENTIFY POTENTIAL RICE AREAS</span></span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice detection criteria (during growing season):</span></span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a><span class="co"># - Moderate to high NDVI (0.4-0.8) - active vegetation</span></span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a><span class="co"># - Slightly negative NDWI (-0.2 to 0.1) - moist soil but not flooded</span></span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a><span class="co"># - EVI in moderate range (0.3-0.6)</span></span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a>rice_mask <span class="op">=</span> (</span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a>    (ndvi <span class="op">&gt;</span> <span class="fl">0.4</span>) <span class="op">&amp;</span> (ndvi <span class="op">&lt;</span> <span class="fl">0.8</span>) <span class="op">&amp;</span></span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a>    (ndwi <span class="op">&gt;</span> <span class="op">-</span><span class="fl">0.2</span>) <span class="op">&amp;</span> (ndwi <span class="op">&lt;</span> <span class="fl">0.1</span>) <span class="op">&amp;</span></span>
<span id="cb66-121"><a href="#cb66-121" aria-hidden="true" tabindex="-1"></a>    (evi <span class="op">&gt;</span> <span class="fl">0.3</span>) <span class="op">&amp;</span> (evi <span class="op">&lt;</span> <span class="fl">0.6</span>)</span>
<span id="cb66-122"><a href="#cb66-122" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate area</span></span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a>rice_pixels <span class="op">=</span> rice_mask.<span class="bu">sum</span>()</span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a>pixel_area_m2 <span class="op">=</span> <span class="dv">10</span> <span class="op">*</span> <span class="dv">10</span>  <span class="co"># 10m resolution</span></span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a>rice_area_ha <span class="op">=</span> (rice_pixels <span class="op">*</span> pixel_area_m2) <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 5: Rice area detection ✓"</span>)</span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Potential rice area: </span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Percentage of Palawan: </span><span class="sc">{</span>(rice_pixels <span class="op">/</span> rice_mask.size) <span class="op">*</span> <span class="dv">100</span><span class="sc">:.2f}</span><span class="ss">%"</span>)</span>
<span id="cb66-132"><a href="#cb66-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-133"><a href="#cb66-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Save rice mask</span></span>
<span id="cb66-134"><a href="#cb66-134" aria-hidden="true" tabindex="-1"></a>rice_meta <span class="op">=</span> out_meta.copy()</span>
<span id="cb66-135"><a href="#cb66-135" aria-hidden="true" tabindex="-1"></a>rice_meta.update(dtype<span class="op">=</span><span class="st">'uint8'</span>, count<span class="op">=</span><span class="dv">1</span>, nodata<span class="op">=</span><span class="dv">255</span>)</span>
<span id="cb66-136"><a href="#cb66-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-137"><a href="#cb66-137" aria-hidden="true" tabindex="-1"></a>rice_mask_path <span class="op">=</span> output_dir <span class="op">/</span> <span class="st">'palawan_rice_mask.tif'</span></span>
<span id="cb66-138"><a href="#cb66-138" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> rasterio.<span class="bu">open</span>(rice_mask_path, <span class="st">'w'</span>, <span class="op">**</span>rice_meta) <span class="im">as</span> dst:</span>
<span id="cb66-139"><a href="#cb66-139" aria-hidden="true" tabindex="-1"></a>    dst.write(rice_mask.astype(<span class="st">'uint8'</span>), <span class="dv">1</span>)</span>
<span id="cb66-140"><a href="#cb66-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-141"><a href="#cb66-141" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-142"><a href="#cb66-142" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. VISUALIZE RESULTS</span></span>
<span id="cb66-143"><a href="#cb66-143" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-144"><a href="#cb66-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-145"><a href="#cb66-145" aria-hidden="true" tabindex="-1"></a>fig, axes <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">18</span>, <span class="dv">12</span>))</span>
<span id="cb66-146"><a href="#cb66-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-147"><a href="#cb66-147" aria-hidden="true" tabindex="-1"></a><span class="co"># True color composite</span></span>
<span id="cb66-148"><a href="#cb66-148" aria-hidden="true" tabindex="-1"></a>rgb <span class="op">=</span> np.stack([red, green, blue], axis<span class="op">=</span><span class="dv">2</span>) <span class="op">/</span> <span class="dv">10000</span></span>
<span id="cb66-149"><a href="#cb66-149" aria-hidden="true" tabindex="-1"></a>rgb_clip <span class="op">=</span> np.clip(rgb, <span class="dv">0</span>, <span class="fl">0.3</span>) <span class="op">/</span> <span class="fl">0.3</span></span>
<span id="cb66-150"><a href="#cb66-150" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].imshow(rgb_clip)</span>
<span id="cb66-151"><a href="#cb66-151" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].set_title(<span class="st">"True Color Composite"</span>)</span>
<span id="cb66-152"><a href="#cb66-152" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-153"><a href="#cb66-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-154"><a href="#cb66-154" aria-hidden="true" tabindex="-1"></a><span class="co"># NDVI</span></span>
<span id="cb66-155"><a href="#cb66-155" aria-hidden="true" tabindex="-1"></a>im1 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">1</span>].imshow(ndvi, cmap<span class="op">=</span><span class="st">'RdYlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-156"><a href="#cb66-156" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].set_title(<span class="st">"NDVI"</span>)</span>
<span id="cb66-157"><a href="#cb66-157" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-158"><a href="#cb66-158" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im1, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">1</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb66-159"><a href="#cb66-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-160"><a href="#cb66-160" aria-hidden="true" tabindex="-1"></a><span class="co"># EVI</span></span>
<span id="cb66-161"><a href="#cb66-161" aria-hidden="true" tabindex="-1"></a>im2 <span class="op">=</span> axes[<span class="dv">0</span>, <span class="dv">2</span>].imshow(evi, cmap<span class="op">=</span><span class="st">'YlGn'</span>, vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-162"><a href="#cb66-162" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">2</span>].set_title(<span class="st">"EVI"</span>)</span>
<span id="cb66-163"><a href="#cb66-163" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">0</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-164"><a href="#cb66-164" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im2, ax<span class="op">=</span>axes[<span class="dv">0</span>, <span class="dv">2</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb66-165"><a href="#cb66-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-166"><a href="#cb66-166" aria-hidden="true" tabindex="-1"></a><span class="co"># NDWI</span></span>
<span id="cb66-167"><a href="#cb66-167" aria-hidden="true" tabindex="-1"></a>im3 <span class="op">=</span> axes[<span class="dv">1</span>, <span class="dv">0</span>].imshow(ndwi, cmap<span class="op">=</span><span class="st">'Blues'</span>, vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb66-168"><a href="#cb66-168" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].set_title(<span class="st">"NDWI"</span>)</span>
<span id="cb66-169"><a href="#cb66-169" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">0</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-170"><a href="#cb66-170" aria-hidden="true" tabindex="-1"></a>plt.colorbar(im3, ax<span class="op">=</span>axes[<span class="dv">1</span>, <span class="dv">0</span>], shrink<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb66-171"><a href="#cb66-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-172"><a href="#cb66-172" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice mask</span></span>
<span id="cb66-173"><a href="#cb66-173" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>)</span>
<span id="cb66-174"><a href="#cb66-174" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].set_title(<span class="ss">f"Potential Rice Areas</span><span class="ch">\n</span><span class="sc">{</span>rice_area_ha<span class="sc">:.1f}</span><span class="ss"> hectares"</span>)</span>
<span id="cb66-175"><a href="#cb66-175" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">1</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-176"><a href="#cb66-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-177"><a href="#cb66-177" aria-hidden="true" tabindex="-1"></a><span class="co"># Rice mask over true color</span></span>
<span id="cb66-178"><a href="#cb66-178" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].imshow(rgb_clip)</span>
<span id="cb66-179"><a href="#cb66-179" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].imshow(rice_mask, cmap<span class="op">=</span><span class="st">'Greens'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb66-180"><a href="#cb66-180" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].set_title(<span class="st">"Rice Areas (overlay)"</span>)</span>
<span id="cb66-181"><a href="#cb66-181" aria-hidden="true" tabindex="-1"></a>axes[<span class="dv">1</span>, <span class="dv">2</span>].axis(<span class="st">'off'</span>)</span>
<span id="cb66-182"><a href="#cb66-182" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-183"><a href="#cb66-183" aria-hidden="true" tabindex="-1"></a>plt.suptitle(<span class="st">"Palawan Rice Monitoring Analysis"</span>, fontsize<span class="op">=</span><span class="dv">16</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb66-184"><a href="#cb66-184" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb66-185"><a href="#cb66-185" aria-hidden="true" tabindex="-1"></a>plt.savefig(output_dir <span class="op">/</span> <span class="st">'palawan_analysis_results.png'</span>, dpi<span class="op">=</span><span class="dv">150</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span>
<span id="cb66-186"><a href="#cb66-186" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb66-187"><a href="#cb66-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-188"><a href="#cb66-188" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-189"><a href="#cb66-189" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. PREPARE ML TRAINING DATA</span></span>
<span id="cb66-190"><a href="#cb66-190" aria-hidden="true" tabindex="-1"></a><span class="co"># ============================================================</span></span>
<span id="cb66-191"><a href="#cb66-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-192"><a href="#cb66-192" aria-hidden="true" tabindex="-1"></a><span class="co"># Rasterize training polygons</span></span>
<span id="cb66-193"><a href="#cb66-193" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.features <span class="im">import</span> rasterize</span>
<span id="cb66-194"><a href="#cb66-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-195"><a href="#cb66-195" aria-hidden="true" tabindex="-1"></a>training_reprojected <span class="op">=</span> training.to_crs(out_meta[<span class="st">'crs'</span>])</span>
<span id="cb66-196"><a href="#cb66-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-197"><a href="#cb66-197" aria-hidden="true" tabindex="-1"></a>training_raster <span class="op">=</span> rasterize(</span>
<span id="cb66-198"><a href="#cb66-198" aria-hidden="true" tabindex="-1"></a>    [(geom, value) <span class="cf">for</span> geom, value <span class="kw">in</span> <span class="bu">zip</span>(training_reprojected.geometry, training_reprojected[<span class="st">'class_id'</span>])],</span>
<span id="cb66-199"><a href="#cb66-199" aria-hidden="true" tabindex="-1"></a>    out_shape<span class="op">=</span>(out_meta[<span class="st">'height'</span>], out_meta[<span class="st">'width'</span>]),</span>
<span id="cb66-200"><a href="#cb66-200" aria-hidden="true" tabindex="-1"></a>    transform<span class="op">=</span>out_meta[<span class="st">'transform'</span>],</span>
<span id="cb66-201"><a href="#cb66-201" aria-hidden="true" tabindex="-1"></a>    fill<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb66-202"><a href="#cb66-202" aria-hidden="true" tabindex="-1"></a>    dtype<span class="op">=</span><span class="st">'uint8'</span></span>
<span id="cb66-203"><a href="#cb66-203" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-204"><a href="#cb66-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-205"><a href="#cb66-205" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract features and labels</span></span>
<span id="cb66-206"><a href="#cb66-206" aria-hidden="true" tabindex="-1"></a>features <span class="op">=</span> np.stack([blue, green, red, nir, ndvi, evi, ndwi], axis<span class="op">=</span><span class="dv">0</span>)  <span class="co"># (7, H, W)</span></span>
<span id="cb66-207"><a href="#cb66-207" aria-hidden="true" tabindex="-1"></a>features_2d <span class="op">=</span> features.reshape(features.shape[<span class="dv">0</span>], <span class="op">-</span><span class="dv">1</span>).T  <span class="co"># (n_pixels, 7)</span></span>
<span id="cb66-208"><a href="#cb66-208" aria-hidden="true" tabindex="-1"></a>labels <span class="op">=</span> training_raster.flatten()</span>
<span id="cb66-209"><a href="#cb66-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-210"><a href="#cb66-210" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter to labeled pixels</span></span>
<span id="cb66-211"><a href="#cb66-211" aria-hidden="true" tabindex="-1"></a>labeled_idx <span class="op">=</span> labels <span class="op">&gt;</span> <span class="dv">0</span></span>
<span id="cb66-212"><a href="#cb66-212" aria-hidden="true" tabindex="-1"></a>X <span class="op">=</span> features_2d[labeled_idx]</span>
<span id="cb66-213"><a href="#cb66-213" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> labels[labeled_idx]</span>
<span id="cb66-214"><a href="#cb66-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-215"><a href="#cb66-215" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Step 7: ML training data prepared ✓"</span>)</span>
<span id="cb66-216"><a href="#cb66-216" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Features shape: </span><span class="sc">{</span>X<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-217"><a href="#cb66-217" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Labels shape: </span><span class="sc">{</span>y<span class="sc">.</span>shape<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-218"><a href="#cb66-218" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Feature names: blue, green, red, nir, ndvi, evi, ndwi"</span>)</span>
<span id="cb66-219"><a href="#cb66-219" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Classes: </span><span class="sc">{</span>np<span class="sc">.</span>unique(y)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-220"><a href="#cb66-220" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-221"><a href="#cb66-221" aria-hidden="true" tabindex="-1"></a><span class="co"># Save training data</span></span>
<span id="cb66-222"><a href="#cb66-222" aria-hidden="true" tabindex="-1"></a>np.savez(</span>
<span id="cb66-223"><a href="#cb66-223" aria-hidden="true" tabindex="-1"></a>    output_dir <span class="op">/</span> <span class="st">'training_data.npz'</span>,</span>
<span id="cb66-224"><a href="#cb66-224" aria-hidden="true" tabindex="-1"></a>    features<span class="op">=</span>X,</span>
<span id="cb66-225"><a href="#cb66-225" aria-hidden="true" tabindex="-1"></a>    labels<span class="op">=</span>y,</span>
<span id="cb66-226"><a href="#cb66-226" aria-hidden="true" tabindex="-1"></a>    feature_names<span class="op">=</span>[<span class="st">'blue'</span>, <span class="st">'green'</span>, <span class="st">'red'</span>, <span class="st">'nir'</span>, <span class="st">'ndvi'</span>, <span class="st">'evi'</span>, <span class="st">'ndwi'</span>]</span>
<span id="cb66-227"><a href="#cb66-227" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-228"><a href="#cb66-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-229"><a href="#cb66-229" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">"</span> <span class="op">+</span> <span class="st">"="</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb66-230"><a href="#cb66-230" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"ANALYSIS COMPLETE!"</span>)</span>
<span id="cb66-231"><a href="#cb66-231" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"="</span><span class="op">*</span><span class="dv">60</span>)</span>
<span id="cb66-232"><a href="#cb66-232" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Outputs saved to: </span><span class="sc">{</span>output_dir<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb66-233"><a href="#cb66-233" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Files created:"</span>)</span>
<span id="cb66-234"><a href="#cb66-234" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_sentinel2_clipped.tif"</span>)</span>
<span id="cb66-235"><a href="#cb66-235" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_ndvi.tif, palawan_evi.tif, palawan_ndwi.tif"</span>)</span>
<span id="cb66-236"><a href="#cb66-236" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_rice_mask.tif"</span>)</span>
<span id="cb66-237"><a href="#cb66-237" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - palawan_analysis_results.png"</span>)</span>
<span id="cb66-238"><a href="#cb66-238" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"  - training_data.npz (ready for ML in Sessions 5-7!)"</span>)</span>
<span id="cb66-239"><a href="#cb66-239" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"</span><span class="ch">\n</span><span class="st">Next: Use training_data.npz to train Random Forest or CNN classifier"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>What we accomplished:</strong></p>
<ol type="1">
<li>✓ Loaded vector and raster data</li>
<li>✓ Clipped raster to area of interest</li>
<li>✓ Calculated multiple spectral indices</li>
<li>✓ Applied rule-based classification (rice detection)</li>
<li>✓ Created publication-quality visualizations</li>
<li>✓ Prepared training data for machine learning</li>
<li>✓ Saved all outputs for future use</li>
</ol>
<p>This workflow demonstrates a complete EO analysis pipeline from raw data to ML-ready datasets!</p>
<hr>
</section>
</section>
<section id="key-takeaways" class="level2">
<h2 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h2>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>Session 3 Summary
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Google Colab:</strong> - Cloud-based Python environment, no installation needed - Mount Google Drive for data persistence: <code>drive.mount('/content/drive')</code> - Install geospatial libraries: <code>!pip install geopandas rasterio</code> - Free GPU access for ML (Sessions 5-7)</p>
<p><strong>GeoPandas (Vector Data):</strong> - Read shapefiles/GeoJSON: <code>gpd.read_file(path)</code> - Filter by attributes: <code>gdf[gdf['column'] == value]</code> - Visualize: <code>gdf.plot(column='field', cmap='Set3')</code> - CRS operations: <code>gdf.crs</code>, <code>gdf.to_crs('EPSG:32651')</code> - <strong>Philippine CRS:</strong> UTM Zone 51N (EPSG:32651) for western Philippines, UTM Zone 52N (EPSG:32652) for eastern Philippines</p>
<p><strong>Rasterio (Raster Data):</strong> - Open rasters: <code>with rasterio.open(path) as src:</code> - Read bands: <code>src.read(band_number)</code> (1-indexed!) - Arrays are NumPy: all array operations work (vectorized!) - Calculate indices: <code>ndvi = (nir - red) / (nir + red + 1e-10)</code> - <strong>Sentinel-2:</strong> 13 bands at 10m/20m/60m, values 0-10000 (divide by 10000 for reflectance)</p>
<p><strong>Combining Vector + Raster:</strong> - Clip rasters: <code>rasterio.mask.mask(src, shapes, crop=True)</code> - Sample at points: <code>src.sample(coordinates)</code> - Zonal statistics: <code>rasterstats.zonal_stats(polygons, raster)</code> - <strong>Always match CRS</strong> before spatial operations!</p>
<p><strong>Preprocessing for ML:</strong> - Normalize: <code>StandardScaler().fit_transform(features)</code> - Augment: Rotation, flipping, brightness adjustment - Multi-temporal: Stack dates for phenology - Resample: Match resolutions from different sensors</p>
<p><strong>Python for EO Advantage:</strong> - Powers operational systems (DATOS, PRiSM, SkAI-Pinas) - Seamless workflow: data access → preprocessing → ML → visualization - Rich ecosystem: GeoPandas, Rasterio, Scikit-learn, TensorFlow - <strong>You now have the foundation to build your own EO applications!</strong></p>
<p><strong>Next:</strong> Session 4 will leverage Google Earth Engine to access petabytes of Sentinel data without downloading!</p>
</div>
</div>
<hr>
</section>
<section id="practice-exercises" class="level2">
<h2 class="anchored" data-anchor-id="practice-exercises">Practice Exercises</h2>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Try These Challenges
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Exercise 1: Load Your Own Boundary</strong></p>
<p>Download a shapefile of your province or municipality from NAMRIA Geoportal or PhilGIS. Load it with GeoPandas, reproject to UTM 51N, calculate the area in km², and create a 5 km buffer zone.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>my_boundary <span class="op">=</span> gpd.read_file(<span class="st">'my_province.shp'</span>)</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co"># ...</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Exercise 2: Calculate Multiple Indices</strong></p>
<p>Using the provided Sentinel-2 tile, calculate NDVI, EVI, NDWI, and SAVI. Create a 2×2 subplot visualization comparing all indices.</p>
<p><strong>Exercise 3: Multi-temporal NDVI Change</strong></p>
<p>If you have two Sentinel-2 images (dry season, wet season), calculate NDVI for both and create a change map showing NDVI difference. Interpret areas of gain (positive change) vs.&nbsp;loss (negative change).</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint:</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>ndvi_change <span class="op">=</span> ndvi_wet <span class="op">-</span> ndvi_dry</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>plt.imshow(ndvi_change, cmap<span class="op">=</span><span class="st">'RdBu'</span>, vmin<span class="op">=-</span><span class="fl">0.5</span>, vmax<span class="op">=</span><span class="fl">0.5</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p><strong>Exercise 4: Training Sample Creation</strong></p>
<p>Create a small training dataset by: 1. Digitizing 3-5 polygons for each land cover class (use <code>gdf = gpd.GeoDataFrame()</code> manually) 2. Rasterizing the polygons to match Sentinel-2 grid 3. Extracting spectral values at labeled pixels 4. Saving as <code>training_samples.csv</code> for ML</p>
<p><strong>Exercise 5: Coastal Water Body Detection</strong></p>
<p>For a coastal area, use NDWI to detect water bodies. Apply a threshold (e.g., NDWI &gt; 0.3), vectorize the result using <code>rasterio.features.shapes()</code>, and save as a shapefile.</p>
<p><strong>Bonus: Build Your Own Function Library</strong></p>
<p>Create a Python module <code>eo_utils.py</code> with reusable functions: - <code>calculate_indices(bands_dict)</code> → returns dict of indices - <code>clip_raster_to_aoi(raster_path, aoi_gdf)</code> → returns clipped array - <code>visualize_results(rgb, ndvi, mask)</code> → creates 3-panel figure - <code>prepare_ml_data(raster_path, training_gdf)</code> → returns X, y arrays</p>
<p>Save to your Drive and import in future notebooks!</p>
</div>
</div>
<hr>
</section>
<section id="further-reading" class="level2">
<h2 class="anchored" data-anchor-id="further-reading">Further Reading</h2>
<section id="geopandas" class="level3">
<h3 class="anchored" data-anchor-id="geopandas">GeoPandas</h3>
<ul>
<li><a href="https://geopandas.org/">Official Documentation</a></li>
<li><a href="https://www.datacamp.com/tutorial/geopandas-tutorial-geospatial-analysis">GeoPandas Tutorial (DataCamp)</a></li>
<li><a href="https://geopandas.org/en/stable/gallery/index.html">GeoPandas Examples Gallery</a></li>
<li><a href="https://geopandas.org/en/stable/docs/user_guide/projections.html">Working with Projections</a></li>
</ul>
</section>
<section id="rasterio" class="level3">
<h3 class="anchored" data-anchor-id="rasterio">Rasterio</h3>
<ul>
<li><a href="https://rasterio.readthedocs.io/">Official Documentation</a></li>
<li><a href="https://rasterio.readthedocs.io/en/stable/quickstart.html">Rasterio Quickstart</a></li>
<li><a href="https://geoscripting-wur.github.io/PythonRaster/">Python Raster Tutorial (WUR)</a></li>
<li><a href="https://rasterio.readthedocs.io/en/stable/topics/windowed-rw.html">Windowed Reading and Writing</a></li>
</ul>
</section>
<section id="combined-workflows" class="level3">
<h3 class="anchored" data-anchor-id="combined-workflows">Combined Workflows</h3>
<ul>
<li><a href="https://carpentries-incubator.github.io/geospatial-python/">Carpentries Geospatial Python</a></li>
<li><a href="https://rasterio.readthedocs.io/en/stable/topics/masking-by-shapefile.html">Cropping Rasters with Vector Boundaries</a></li>
<li><a href="https://www.oreilly.com/library/view/python-for-geospatial/9781098104788/">Python for Geospatial Analysis (O’Reilly)</a></li>
</ul>
</section>
<section id="philippine-context" class="level3">
<h3 class="anchored" data-anchor-id="philippine-context">Philippine Context</h3>
<ul>
<li><a href="https://www.namria.gov.ph/">NAMRIA Geoportal</a></li>
<li><a href="https://philgis.org/">PhilGIS Resources</a></li>
<li><a href="https://datos.dost.gov.ph/">DATOS User Guide</a> (if publicly available)</li>
<li><a href="https://prism.philrice.gov.ph/">PRiSM Technical Documentation</a></li>
</ul>
</section>
<section id="advanced-topics" class="level3">
<h3 class="anchored" data-anchor-id="advanced-topics">Advanced Topics</h3>
<ul>
<li><a href="https://docs.xarray.dev/">Xarray for Multi-dimensional Arrays</a></li>
<li><a href="https://docs.dask.org/">Dask for Parallel Computing</a></li>
<li><a href="https://www.cogeo.org/">Cloud-Optimized GeoTIFF Guide</a></li>
<li><a href="https://torchgeo.readthedocs.io/">TorchGeo for Deep Learning</a></li>
</ul>
<hr>
</section>
</section>
<section id="jupyter-notebook" class="level2">
<h2 class="anchored" data-anchor-id="jupyter-notebook">Jupyter Notebook</h2>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Access the Interactive Notebook
</div>
</div>
<div class="callout-body-container callout-body">
<p>A complete Jupyter notebook with all code examples from this session is available:</p>
<p><strong><a href="../../day1/notebooks/notebook1.html">Open Notebook 1: Python Geospatial Data →</a></strong></p>
<p>This notebook includes: - All code examples ready to run in Google Colab - Additional exercises with progressive difficulty - Sample datasets (downloadable links) - Detailed comments and explanations - Solutions to practice exercises (hidden cells) - Links to relevant documentation</p>
<p><strong>To use the notebook:</strong> 1. Click the link above 2. Click “Open in Colab” button 3. Save a copy to your Drive: File → Save a copy in Drive 4. Mount your Drive and start coding!</p>
</div>
</div>
<hr>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<script src="https://utteranc.es/client.js" repo="cophil-training-v1.0" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../day1/sessions/session2.html" class="pagination-link" aria-label="Session 2: Core Concepts of AI/ML for Earth Observation">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Session 2: Core Concepts of AI/ML for Earth Observation</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../day1/sessions/session4.html" class="pagination-link" aria-label="Session 4: Introduction to Google Earth Engine">
        <span class="nav-page-text">Session 4: Introduction to Google Earth Engine</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>CoPhil EO AI/ML Training Programme</p>
</div>   
    <div class="nav-footer-center">
<p>Funded by the European Union - Global Gateway Initiative</p>
</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:skotsopoulos@neuralio.ai">
      <i class="bi bi-envelope" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://philsa.gov.ph">
      <i class="bi bi-globe" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




<script src="../../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>